/*! MathLib v0.4.0 MathLib.de | MathLib.de/en/license */var __extends=this.__extends||function(d,b){function __(){this.constructor=d}__.prototype=b.prototype,d.prototype=new __},MathLib;if(function(MathLib){MathLib.version="0.4.0",MathLib.apery=1.2020569031595942,MathLib.e=Math.E,MathLib.epsilon=Number.EPSILON||function(){var next,result;for(next=1;1!==1+next;next/=2)result=next;return result}(),MathLib.eulerMascheroni=.5772156649015329,MathLib.goldenRatio=1.618033988749895,MathLib.pi=Math.PI,MathLib.isArrayLike=function(x){return"object"==typeof x&&"length"in x};var prototypes={array:Object.getPrototypeOf([]),func:Object.getPrototypeOf(function(){}),object:Object.getPrototypeOf({}),functn:function(){}},flatten=function(a){var res=[];return a.forEach(function(x){Array.isArray(x)?res=res.concat(flatten(x)):res.push(x)}),res},extendObject=function(dest,src){for(var prop in src)dest[prop]="object"==typeof dest[prop]&&"object"==typeof src[prop]?extendObject(dest[prop],src[prop]):src[prop];return dest},to3js=function(x){return 2===x.length?new THREE.Vector2(x[0],x[1]):3===x.length?new THREE.Vector3(x[0],x[1],x[2]):void 0},colorConvert=function(n){return"number"==typeof n?(n=Math.max(Math.min(Math.floor(n),16777215),0),"#"+("00000"+n.toString(16)).slice(-6)):n};MathLib.prototypes=prototypes,MathLib.extend=function(obj,name,prop,options){options=options||{enumerable:!0};var o=MathLib[obj]||MathLib;Object.defineProperty(o,name,{value:prop,writable:options.writable,enumerable:options.enumerable,configurable:options.configurable})},MathLib.extendPrototype=function(obj,name,prop,options){options=options||{enumerable:!0},Object.defineProperty(prototypes[obj],name,{value:prop,writable:options.writable,enumerable:options.enumerable,configurable:options.configurable})};var MathML=function(){function MathML(MathMLString){this.type="MathML";var MathMLdoc,token,tokenizer=new DOMParser;"string"!=typeof MathMLString&&(MathMLString=MathMLString.toContentMathML()),MathMLString=MathMLString.replace(/\n/g,""),MathMLString=MathMLString.replace(/((?!cs)[^>]{2})>(\s)*</g,"$1><"),MathMLString=MathMLString.replace(/&(\w*);/g,"#$1;"),MathMLdoc=tokenizer.parseFromString(MathMLString,"application/xml");var createToken,curToken=null,tokenStack=[];createToken=function(t){var i,ii,attributes={};if(t.attributes)for(i=0,ii=t.attributes.length;ii>i;i++)attributes[t.attributes[i].name]=t.attributes[i].value;var newToken=Object.create({},{attributes:{value:attributes},nodeName:{value:t.nodeName},parentNode:{value:tokenStack[tokenStack.length-1]},prevNode:{value:curToken}});curToken&&(curToken.nextNode=newToken),curToken=newToken,tokenStack.push(newToken),newToken.childNodes=Array.prototype.slice.call(t.childNodes).map(createToken),tokenStack.pop();var attributesString=function(x){var attr,str="";for(attr in x.attributes)x.attributes.hasOwnProperty(attr)&&(str+=" "+attr+'="'+x.attributes[attr]+'"');return str};if(newToken.innerMathML=0!==newToken.childNodes.length?newToken.childNodes.reduce(function(prev,cur){return prev+cur.outerMathML},""):"",newToken.outerMathML=0===newToken.childNodes.length?"#text"===newToken.nodeName?t.textContent.replace(/#(\w*);/g,"&$1;"):"<"+newToken.nodeName+attributesString(newToken)+"/>":"<"+newToken.nodeName+attributesString(newToken)+">"+newToken.innerMathML+"</"+newToken.nodeName+">","lambda"===newToken.nodeName)for(newToken.bvars=[],i=0,ii=newToken.childNodes.length;ii>i;i++)"bvar"===newToken.childNodes[i].nodeName?newToken.bvars.push(newToken.childNodes[i].childNodes[0].innerMathML):"domainofapplication"===newToken.childNodes[i].nodeName?newToken.domainofapplication=newToken.childNodes[i]:"apply"===newToken.childNodes[i].nodeName&&(newToken.apply=newToken.childNodes[i]);return newToken},token=createToken(MathMLdoc.childNodes[0]),this.attributes=token.attributes,this.childNodes=token.childNodes,this.innerMathML=token.innerMathML,this.outerMathML=token.outerMathML,this.nodeName=token.nodeName,this.nextNode=token.nextNode,this.parentNode=null,this.prevNode=null}return MathML.isSupported=function(){var ns,div,mfrac,hasMathML=!1;return document.createElementNS&&(ns="http://www.w3.org/1998/Math/MathML",div=document.createElement("div"),div.style.position="absolute",mfrac=div.appendChild(document.createElementNS(ns,"math")).appendChild(document.createElementNS(ns,"mfrac")),mfrac.appendChild(document.createElementNS(ns,"mi")).appendChild(document.createTextNode("xx")),mfrac.appendChild(document.createElementNS(ns,"mi")).appendChild(document.createTextNode("yy")),document.body.appendChild(div),hasMathML=div.offsetHeight>div.offsetWidth,document.body.removeChild(div)),hasMathML},MathML.prototype.loadMathJax=function(config){var script=document.createElement("script");script.type="text/javascript",script.src="http://cdn.mathjax.org/mathjax/latest/MathJax.js",config=config||'MathJax.Hub.Config({config: ["MMLorHTML.js"],jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML"],extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js"],TeX: {extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]}});',window.opera?script.innerHTML=config:script.text=config,document.getElementsByTagName("head")[0].appendChild(script)},MathML.prototype.parse=function(){var handlers,apply,parser,construct=!1,bvars=[];return handlers={apply:function(node){var children=node.childNodes,func=children.shift(),funcName=func.nodeName,names={ident:"identity",power:"pow",rem:"mod",setdifference:"without"};if(funcName in names&&(funcName=names[funcName]),construct){var innerFunc;return innerFunc=parser(children[0]),void 0===innerFunc?new MathLib.Functn(function(x){return MathLib[funcName](x)},{contentMathMLString:'<math xmlns="http://www.w3.org/1998/Math/MathML"><lambda><bvar><ci>x</ci></bvar><domainofapplication><reals/></domainofapplication>'+node.outerMathML+"</lambda></math>"}):new MathLib.Functn(function(x){return MathLib[funcName](innerFunc(x))},{contentMathMLString:node.outerMathML})}if(funcName in MathLib)return 1===children.length?MathLib[funcName](parser(children[0])):MathLib[funcName].apply(null,children.map(parser));var child=parser(children.shift());return 1===children.length?child[funcName](parser(children[0])):child[funcName](children.map(parser))},ci:function(node){return-1===bvars.indexOf(node.innerMathML)?MathLib.MathML.variables[node.innerMathML]:new MathLib.Functn(function(x){return x},{contentMathMLString:'<math xmlns="http://www.w3.org/1998/Math/MathML"><lambda><bvar><ci>x</ci></bvar><domainofapplication><reals/></domainofapplication><apply><ident/><ci>x</ci></apply></lambda></math>'})},cn:function(node){var type=node.attributes.type?node.attributes.type:"number";return"number"===type?+node.innerMathML:"complex-cartesian"===type?new MathLib.Complex(+node.childNodes[0].outerMathML,+node.childNodes[2].outerMathML):"complex-polar"===type?MathLib.Complex.polar(+node.childNodes[0].outerMathML,+node.childNodes[2].outerMathML):void 0},cs:function(node){return node.innerMathML},lambda:function(node){var domain,funcName,innerFunc,names;return bvars=bvars.concat(node.bvars),domain=node.domainofapplication,apply=node.apply,funcName=apply.childNodes[0].nodeName,construct=!0,names={ident:"identity",power:"pow",rem:"mod",setdifference:"without"},funcName in names&&(funcName=names[funcName]),innerFunc=parser(apply.childNodes.slice(1)),void 0===innerFunc[0]?new MathLib.Functn(function(x){return MathLib[funcName](x)},{contentMathMLString:node.outerMathML,domain:domain}):new MathLib.Functn(function(x){return MathLib[funcName].apply(null,innerFunc.map(function(f){return"function"==typeof f?f(x):f}))},{contentMathMLString:node.outerMathML,domain:domain})},math:function(node){return parser(node.childNodes[0])},matrix:function(node){return new MathLib.Matrix(node.childNodes.map(handlers.matrixrow))},matrixrow:function(node){return node.childNodes.map(parser)},set:function(node){var type=node.attributes.type&&"multiset"===node.attributes.type?!0:!1;return new MathLib.Set(node.childNodes.map(parser),type)},"false":function(){return!1},"true":function(){return!0},exponentiale:function(){return MathLib.e},imaginaryi:function(){return new MathLib.Complex(0,1)},notanumber:function(){return 0/0},pi:function(){return MathLib.pi},eulergamma:function(){return MathLib.eulerMascheroni},infinity:function(){return 1/0},vector:function(node){return new MathLib.Vector(node.childNodes.map(parser))}},parser=function(node){return Array.isArray(node)?node.map(parser):handlers[node.nodeName](node)},parser(this)},MathML.prototype.toMathMLString=function(){var handlers={apply:function(n){var f=n.childNodes[0],args=n.childNodes.slice(1).map(function(x){return handlers[x.nodeName](x)}),str="";return str="plus"===f.nodeName?"<mrow>"+args.join("<mo>+</mo>")+"</mrow>":"times"===f.nodeName?"<mrow>"+args.join("<mo>*</mo>")+"</mrow>":"power"===f.nodeName?"<msup>"+args[0]+args[1]+"</msup>":"<mrow><mi>"+f.nodeName+"</mi><mo>&af;</mo><mfenced>"+args.join("")+"</mfenced></mrow>"},bvar:function(){return""},ci:function(n){return"<mi>"+n.innerMathML+"</mi>"},cn:function(n){return"<mn>"+n.innerMathML+"</mn>"},cs:function(n){return"<ms>"+n.innerMathML+"</ms>"},domainofapplication:function(){return""},lambda:function(n){return n.childNodes.reduce(function(old,cur){return old+handlers[cur.nodeName](cur)},"")},"#text":function(n){return n.innerMathML}};return'<math xmlns="http://www.w3.org/1998/Math/MathML">'+handlers[this.childNodes[0].nodeName](this.childNodes[0])+"</math>"},MathML.prototype.toString=function(){return this.outerMathML},MathML.variables={},MathML.write=function(id,math){var formula;document.getElementById(id).innerHTML="<math>"+math+"</math>","undefined"!=typeof MathJax&&(formula=MathJax.Hub.getAllJax(id)[0],MathJax.Hub.Queue(["Typeset",MathJax.Hub,id]))},MathML}();MathLib.MathML=MathML;var functnPrototype={};MathLib.Functn=function(f,options){options=options||{};var functn=function(x){if("number"==typeof x)return f.apply("",arguments);if("functn"===x.type){var outerVar=functn.contentMathML.childNodes[0].childNodes[0].childNodes[0].outerMathML,innerVar=x.contentMathML.childNodes[0].childNodes[0].childNodes[0].outerMathML,innerStr=x.contentMathML.childNodes[0].childNodes[2].outerMathML.replace("<bvar>"+innerVar+"</bvar>",""),outerStr=functn.contentMathML.childNodes[0].childNodes[2].outerMathML.replace(outerVar,innerStr),res='<math xmlns="http://www.w3.org/1998/Math/MathML"><lambda><bvar>'+innerVar+"</bvar><domainofapplication><reals/></domainofapplication>"+outerStr+"</lambda></math>";return new MathLib.Functn(function(y){return f(x(y))},{contentMathMLString:res})}return"function"==typeof x?function(y){return f(x(y))}:"complex"===x.type?x[options.name].apply(x,Array.prototype.slice.call(arguments,1)):x[options.name]()};for(var name in functnPrototype)functnPrototype.hasOwnProperty(name)&&(functn[name]=functnPrototype[name]);functn.type="functn",functn.constructor=MathLib.Functn;var contentMathML=options.contentMathMLString||"";return Object.defineProperties(functn,{id:{value:options.name},contentMathML:{value:new MathLib.MathML(contentMathML)}}),functn},functnPrototype.draw=function(screen,options){options===void 0&&(options={});var functn=this;return Array.isArray(screen)?screen.forEach(function(x){x.path(functn,options)}):screen.path(functn,options),this},functnPrototype.diff=function(x,h){return h===void 0&&(h=1e-5),(this(x+h)-this(x-h))/(2*h)},functnPrototype.quad=function(a,b,options){options===void 0&&(options={});var Q,f=this,warnMessage=["Calculation succeded","Minimum step size reached","Maximum function count exceeded","Infinite or NaN function value encountered"];return options.calls=3,options.warn=0,a===-1/0&&(a=-Number.MAX_VALUE),1/0===b&&(b=Number.MAX_VALUE),"minStep"in options||(options.minStep=1e-15),"maxCalls"in options||(options.maxCalls=1e4),"tolerance"in options||(options.tolerance=1e-5),Q=quadstep(f,a,b,f(a),f((a+b)/2),f(b),options),options.warnMessage=warnMessage[options.warn],Q};var quadstep=function(f,a,b,fa,fc,fb,options){var h=b-a,c=(a+b)/2,fd=f((a+c)/2),fe=f((c+b)/2),Q1=h/6*(fa+4*fc+fb),Q2=h/12*(fa+4*fd+2*fc+4*fe+fb),Q=Q2+(Q2-Q1)/15;return options.calls=options.calls+2,MathLib.isFinite(Q)?options.calls>options.maxCalls?(options.warn=Math.max(options.warn,2),Q):Math.abs(Q2-Q)<=options.tolerance?Q:Math.abs(h)<options.minStep||c===a||c===b?(options.warn=Math.max(options.warn,1),Q):quadstep(f,a,c,fa,fd,fc,options)+quadstep(f,c,b,fc,fe,fb,options):(options.warn=Math.max(options.warn,3),Q)};functnPrototype.toContentMathML=function(){return this.contentMathML},functnPrototype.toContentMathMLString=function(bvar){return bvar===void 0&&(bvar=""),this.contentMathML.outerMathML},functnPrototype.toLaTeX=function(bvar){bvar===void 0&&(bvar="");var handlers={apply:function(n){var f=n.childNodes[0],args=n.childNodes.slice(1).map(function(x){return handlers[x.nodeName](x)}),str="";return str="plus"===f.nodeName?args.join("+"):"times"===f.nodeName?args.join("*"):"power"===f.nodeName?args[0]+"^{"+args[1]+"}":"\\"+f.nodeName+"("+args.join(", ")+")"},bvar:function(){return""},ci:function(n){return bvar||n.innerMathML},cn:function(n){return n.innerMathML},cs:function(n){return n.innerMathML},domainofapplication:function(){return""},lambda:function(n){return n.childNodes.reduce(function(old,cur){return old+handlers[cur.nodeName](cur)},"")},"#text":function(n){return n.innerMathML}};return handlers[this.contentMathML.childNodes[0].nodeName](this.contentMathML.childNodes[0])},functnPrototype.toMathMLString=function(){return this.contentMathML.toMathMLString()},functnPrototype.toString=function(bvar){bvar===void 0&&(bvar="");var handlers={apply:function(n){var f=n.childNodes[0],args=n.childNodes.slice(1).map(function(x){return handlers[x.nodeName](x)}),str="";return str="plus"===f.nodeName?args.join("+"):"times"===f.nodeName?args.join("*"):"power"===f.nodeName?args[0]+"^"+args[1]:f.nodeName+"("+args.join(", ")+")"},bvar:function(){return""},ci:function(n){return bvar||n.innerMathML},cn:function(n){return n.innerMathML},cs:function(n){return n.innerMathML},domainofapplication:function(){return""},lambda:function(n){return n.childNodes.reduce(function(old,cur){return old+handlers[cur.nodeName](cur)},"")},"#text":function(n){return n.innerMathML}};return handlers[this.contentMathML.childNodes[0].nodeName](this.contentMathML.childNodes[0])};var mathStart='<math xmlns="http://www.w3.org/1998/Math/MathML"><lambda><bvar><ci>x</ci></bvar><domainofapplication><reals/></domainofapplication><apply><',mathEnd="/><ci>x</ci></apply></lambda></math>",unaryFunctions={abs:Math.abs,arccos:Math.acos,arccot:function(x){return 1.5707963267948966-Math.atan(x)},arccsc:function(x){return Math.asin(1/x)},arcosh:Math.acosh||function(x){return Math.log(x+Math.sqrt(x*x-1))},arcoth:function(x){return MathLib.isFinite(x)?.5*Math.log((x+1)/(x-1)):1/x},arcsch:function(x){return 0!==x&&MathLib.isFinite(x)?Math.log(1/x+Math.sqrt(1/(x*x)+1)):1/x},arcsec:function(x){return Math.acos(1/x)},arcsin:Math.asin,arctan:Math.atan,arsech:function(x){return Math.log((1+Math.sqrt(1-x*x))/x)},arsinh:Math.asinh||function(x){return 0!==x&&MathLib.isFinite(x)?Math.log(x+Math.sqrt(x*x+1)):x},artanh:Math.atanh||function(x){return 0===x?x:.5*Math.log((1+x)/(1-x))},ceil:function(x){return 0===x?x:Math.ceil(x)},floor:Math.floor,cos:Math.cos,cosh:Math.cosh||function(x){return(Math.exp(x)+Math.exp(-x))/2},cot:function(x){return 0===x?1/x:Math.tan(1.5707963267948966-x)},coth:function(x){return 0===x?1/x:MathLib.isFinite(x)?(Math.exp(x)+Math.exp(-x))/(Math.exp(x)-Math.exp(-x)):MathLib.sign(x)},csc:function(x){return 1/Math.sin(x)},csch:function(x){return 0===x?1/x:2/(Math.exp(x)-Math.exp(-x))},exp:function(x){return Math.exp(x)},inverse:function(x){return 1/x},sec:function(x){return 1/Math.cos(x)},sech:function(x){return 2/(Math.exp(x)+Math.exp(-x))},sin:Math.sin,sinh:Math.sinh||function(x){return 0===x?x:(Math.exp(x)-Math.exp(-x))/2},tan:Math.tan,tanh:Math.tanh||function(x){var p;return 0!==x&&MathLib.isFinite(x)?(p=Math.exp(x),(p*p-1)/(p*p+1)):MathLib.sign(x)}};for(var elemfn in unaryFunctions)unaryFunctions.hasOwnProperty(elemfn)&&MathLib.extend("",elemfn,new MathLib.Functn(unaryFunctions[elemfn],{name:elemfn,contentMathMLString:mathStart+elemfn+mathEnd}));MathLib.identity=new MathLib.Functn(function(x){return x},{contentMathMLString:mathStart+"ident"+mathEnd});var functionList1={arctan2:Math.atan2,binomial:function(n,k){var i,res=1;if(0>k||n>0&&k>n)return 0;for(0>n&&(res=Math.pow(-1,k),n=k-n-1),k>n/2&&(k=n-k),i=1;k>=i;i++)res*=(n+1-i)/i;return res},cbrt:function(x){var a3,a3x,an,a;if(0===x||x!==x||1/0===x||x===-1/0)return x;for(a=MathLib.sign(x)*Math.pow(Math.abs(x),1/3);;){if(a3=Math.pow(a,3),a3x=a3+x,an=a*(a3x+x)/(a3x+a3),MathLib.isZero(an-a))break;a=an}return an},conjugate:function(x){return x},copy:function(x){return x},degToRad:function(x){return.017453292519943295*x},digitsum:function(x){for(var out=0;x>9;)out+=x%10,x=Math.floor(x/10);return out+x},divide:function(a,b){return MathLib.times(a,MathLib.inverse(b))},divisors:function(x){var i,ii,res=1===x?[]:[1];for(i=2,ii=x/2;ii>=i;i++)0===x%i&&res.push(i);return res.push(x),MathLib.set(res)},factor:function(n){var i,res=[];for(n=Math.abs(n);0===n%2;)n/=2,res.push(2);for(i=3;1!==n;){for(;0===n%i;)n/=i,res.push(i);i+=2}return new MathLib.Set(res,!0)},factorial:function(x){var i,out=1;if(x>170&&MathLib.isInt(x)||1/0===x)return 1/0;if(0>x||!MathLib.isInt(x)||MathLib.isNaN(x))return 0/0;for(i=1;x>=i;i++)out*=i;return out},fallingFactorial:function(n,m,s){var j,res=1;for(s=s||1,j=0;m>j;j++)res*=n-j*s;return res},fibonacci:function(n){return Math.floor(Math.pow(MathLib.goldenRatio,n)/Math.sqrt(5))},hypot:function(a,b){var args,x,y;return 1===arguments.length?Math.abs(a):(arguments.length>2&&(args=Array.prototype.slice.call(arguments),args.shift(),b=MathLib.hypot.apply(null,args)),a=MathLib.abs(a),b=MathLib.abs(b),1/0===a||1/0===b?1/0:0===a&&0===b?0:(x=Math.max(a,b),y=Math.min(a,b),x*Math.sqrt(1+Math.pow(y/x,2))))},hypot2:function(){var args=Array.prototype.slice.call(arguments);return args.some(function(x){return 1/0===x||x===-1/0})?1/0:args.reduce(function(old,cur){return old+cur*cur},0)},isFinite:function(x){return 1/0>Math.abs(x)},isInt:function(x){return 0===x%1},isNaN:function(x){return x!==x},isNegZero:function(x){return 1/x===-1/0},isOne:function(a){return Math.abs(a-1)<MathLib.epsilon},isPosZero:function(x){return 1/0===1/x},isPrime:function(x){var i,sqrt=Math.sqrt(x);if(0===x%1&&x>1){if(2===x)return!0;if(0===x%2)return!1;for(i=3;sqrt>=i;i+=2)if(0===x%i)return!1;return!0}return!1},isReal:function(){return!0},isZero:function(x){return Math.abs(x)<MathLib.epsilon},lg:function(x){return Math.log(x)/Math.LN10},ln:Math.log,log:function(base,x){return 1===arguments.length&&(x=base,base=10),Math.log(x)/Math.log(base)},minus:function(a,b){return MathLib.plus(a,MathLib.negative(b))},mod:function(n,m){var nm=n%m;return nm>=0?nm:nm+m},negative:function(x){return-x},pow:function(x,y){return 1===x||-1===x&&(1/0===y||y===-1/0)?1:Math.pow(x,y)},radToDeg:function(x){return 57.29577951308232*x},random:Math.random,risingFactorial:function(n,m,s){var j,res=1;for(s=s||1,j=0;m>j;j++)res*=n+j*s;return res},round:function(x){return 0===x?x:Math.round(x)},root:function(x,root){return 1===arguments.length?Math.sqrt(x):Math.pow(x,1/root)},sign:function(x){return x&&(0>x?-1:1)},sqrt:Math.sqrt,trunc:function(x,n){return x.toFixed(n||0)},toLaTeX:function(x,plus){return plus?(0>x?"-":"+")+Math.abs(x):(0>x?"-":"")+Math.abs(x)},toMathMLString:function(x,plus){return plus?"<mo>"+(0>x?"-":"+")+"</mo><mn>"+Math.abs(x)+"</mn>":(0>x?"<mo>-</mo>":"")+"<mn>"+Math.abs(x)+"</mn>"},toString:function(x,plus){return plus?(0>x?"-":"+")+Math.abs(x):(0>x?"-":"")+Math.abs(x)}};MathLib.toContentMathMLString=function(x){return"number"==typeof x?"<cn>"+x+"</cn>":x.toContentMathML()},MathLib.not=function(x){return!x},MathLib.compare=function(a,b){return MathLib.type(a)!==MathLib.type(b)?MathLib.sign(MathLib.type(a).localeCompare(MathLib.type(b))):"number"==typeof a?MathLib.sign(a-b):"string"==typeof a?a.localeCompare(b):a.compare(b)},MathLib.type=function(x){return null===x?"null":void 0===x?"undefined":x.type?x.type:(x.constructor.name||Object.prototype.toString.call(x).slice(8,-1)).toLowerCase()},MathLib.is=function(obj,type){do{if(MathLib.type(obj)===type)return!0;obj=Object.getPrototypeOf(Object(obj))}while(obj);return!1};var nAryFunctions={and:function(n){return n.every(function(x){return!!x})},arithMean:function(n){return MathLib.plus(n)/n.length},gcd:function(a){var min,reduction=function(x){return x!==min?x%min:x},isntZero=function(x){return 0!==x};if(a=a.filter(isntZero).map(Math.abs),0===a.length)return 0;for(;a.length>1;)min=MathLib.min(a),a=a.map(reduction).filter(isntZero);return a[0]||min},geoMean:function(n){return MathLib.root(MathLib.times(n),n.length)},harmonicMean:function(n){return n.length/MathLib.plus(n.map(MathLib.inverse))},lcm:function(n){return MathLib.times(n)/MathLib.gcd(n)},max:function(n){return Math.max.apply(null,n)},min:function(n){return Math.min.apply(null,n)},or:function(n){return n.some(function(x){return!!x})},plus:function(n){return 0===n.length?0:n.reduce(function(a,b){var f1,f2,astr,bstr;if("number"==typeof a&&"number"==typeof b)return a+b;if("functn"===a.type||"functn"===b.type){astr="functn"===a.type?a.contentMathML.childNodes[0].apply.outerMathML:MathLib.toContentMathMLString(a),bstr="functn"===b.type?b.contentMathML.childNodes[0].apply.outerMathML:MathLib.toContentMathMLString(b),f1=a,f2=b,"functn"!==a.type?f1=function(){return a}:"functn"!==b.type&&(f2=function(){return b});var MathML='<math xmlns="http://www.w3.org/1998/Math/MathML"><lambda><bvar><ci>x</ci></bvar><domainofapplication><reals/></domainofapplication><apply><plus/>'+astr+bstr+"</apply></lambda></math>";return new MathLib.Functn(function(x){return MathLib.plus(f1(x),f2(x))},{contentMathMLString:MathML})}return"object"==typeof a?a.plus(b):"object"==typeof b?b.plus(a):void 0})},times:function(n){return 0===n.length?1:n.reduce(function(a,b){var f1,f2,astr,bstr;if("number"==typeof a&&"number"==typeof b)return a*b;if("functn"===a.type||"functn"===b.type){astr="functn"===a.type?a.contentMathML.childNodes[0].apply.outerMathML:MathLib.toContentMathMLString(a),bstr="functn"===b.type?b.contentMathML.childNodes[0].apply.outerMathML:MathLib.toContentMathMLString(b),f1=a,f2=b,"functn"!==a.type?f1=function(){return a}:"functn"!==b.type&&(f2=function(){return b});var MathML='<math xmlns="http://www.w3.org/1998/Math/MathML"><lambda><bvar><ci>x</ci></bvar><domainofapplication><reals/></domainofapplication><apply><times/>'+astr+bstr+"</apply></lambda></math>";return new MathLib.Functn(function(x){return MathLib.times(f1(x),f2(x))},{contentMathMLString:MathML})}return"object"==typeof a?a.times(b):"object"==typeof b?b.times(a):void 0})},xor:function(n){return 0!==n.reduce(function(x,y){return x+!!y},0)%2}};MathLib.isEqual=function(){return flatten(Array.prototype.slice.apply(arguments)).every(function(a,i,arr){return a===arr[0]?!0:"number"==typeof a&&"number"==typeof arr[0]?3e-15>=Math.abs(a-arr[0]):"object"==typeof a?a.isEqual(arr[0]):"object"==typeof arr[0]?arr[0].isEqual(a):!1})};var func,cur,createFunction1=function(f,name){return function(x){return"number"==typeof x?f.apply("",arguments):"function"==typeof x?function(y){return f(x(y))}:"set"===x.type?new MathLib.Set(x.map(f)):"complex"===x.type?x[name].apply(x,Array.prototype.slice.call(arguments,1)):Array.isArray(x)?x.map(f):x[name]()}},createFunction3=function(f){return function(n){return"set"===MathLib.type(n)?f(n.slice()):("array"!==MathLib.type(n)&&(n=Array.prototype.slice.apply(arguments)),f(n))}};for(func in functionList1)functionList1.hasOwnProperty(func)&&(cur=functionList1[func],Object.defineProperty(MathLib,func,{value:createFunction1(functionList1[func],func)}));for(func in nAryFunctions)nAryFunctions.hasOwnProperty(func)&&(cur=nAryFunctions[func],Object.defineProperty(MathLib,func,{value:createFunction3(nAryFunctions[func],func)}));var Screen=function(){function Screen(id,options){options===void 0&&(options={});var _this=this;this.type="screen";var fullscreenchange,innerHTML,_this=this,defaults={height:500,width:500,contextMenu:{screenshot:!0,fullscreen:!0,grid:!0},figcaption:""},opts=extendObject(defaults,options),container=document.getElementById(id),innerHTMLContextMenu="",id=+Date.now();opts.contextMenu&&(!opts.contextMenu.screenshot||"opera"in window||(innerHTMLContextMenu+='<div class="MathLib_screenshot MathLib_menuItem">Save Screenshot</div>'),opts.contextMenu.fullscreen&&"requestFullScreen"in document.body&&(innerHTMLContextMenu+='<div class="MathLib_fullscreen MathLib_menuItem"><span class="needs-nofullscreen">Enter Fullscreen</span><span class="needs-fullscreen">Exit Fullscreen</span></div>'),opts.contextMenu.grid&&(innerHTMLContextMenu+='<div class="MathLib_menuItem MathLib_hasSubmenu">Grid',innerHTMLContextMenu+='<menu class="MathLib_menu MathLib_submenu">',innerHTMLContextMenu+=['<div class="MathLib_needs2D">','<label class="MathLib_menuItem">','<input type="radio" name="MathLib_grid_type_'+id+'" class="MathLib_radio MathLib_grid_type" value="cartesian">cartesian',"</label>",'<label class="MathLib_menuItem">','<input type="radio" name="MathLib_grid_type_'+id+'" class="MathLib_radio MathLib_grid_type" value="polar">polar',"</label>",'<label class="MathLib_menuItem">','<input type="radio" name="MathLib_grid_type_'+id+'" class="MathLib_radio MathLib_grid_type" value="none">none',"</label>","</div>"].join(""),innerHTMLContextMenu+='<div class="MathLib_needs3D MathLib_menuItem MathLib_is_disabled" style="font-size: 0.7em">Gridoptions for 3D are coming soon.</div>',innerHTMLContextMenu+="</menu></div>"),innerHTMLContextMenu+='<hr class="MathLib_separator"><div class="MathLib_is_disabled MathLib_menuItem MathLib_is_centered" style="font-size:0.83em">Plot generated by MathLib.js</div>'),innerHTML=['<figure class="MathLib_figure">','<div class="MathLib_wrapper" style="width: '+opts.width+"px; height: "+opts.height+'px">','<div class="MathLib_info_message">Your browser does not seem to support WebGL.<br>',"Please update your browser to see the plot.</div>","</div>",opts.figcaption?'<figcaption class="MathLib_figcaption">'+opts.figcaption+"</figcaption>":"","</figure>",'<div class="MathLib_contextMenuOverlay">','<menu class="MathLib_menu MathLib_mainmenu">',innerHTMLContextMenu,"</menu>","</div>"].join(""),container.innerHTML=innerHTML,container.classList.add("MathLib_container"),this.height=opts.height,this.width=opts.width,this.options=opts,this.container=container,this.figure=container.getElementsByClassName("MathLib_figure")[0],this.wrapper=container.getElementsByClassName("MathLib_wrapper")[0],this.contextMenu=container.getElementsByClassName("MathLib_mainmenu")[0],this.contextMenuOverlay=container.getElementsByClassName("MathLib_contextMenuOverlay")[0],this.innerHTMLContextMenu=innerHTMLContextMenu,options.contextMenu&&(this.wrapper.oncontextmenu=function(evt){return _this.oncontextmenu(evt)},!opts.contextMenu.screenshot||"opera"in window||(this.contextMenu.getElementsByClassName("MathLib_screenshot")[0].onclick=function(){var dataURI,a=document.createElement("a");if("Canvas"===_this.options.renderer&&"screen2D"===_this.type){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");canvas.height=_this.height,canvas.width=_this.width,ctx.drawImage(_this.layer.back.element,0,0),ctx.drawImage(_this.layer.grid.element,0,0),ctx.drawImage(_this.layer.axis.element,0,0),ctx.drawImage(_this.layer.main.element,0,0),dataURI=canvas.toDataURL("image/png"),"download"in a?(a.href=dataURI,a.download="plot.png",a.click()):window.location.href=dataURI.replace("image/png","image/octet-stream")}"WebGL"===_this.options.renderer&&"screen3D"===_this.type?(dataURI=_this.element.toDataURL("image/png"),"download"in a?(a.href=dataURI,a.download="plot.png",a.click()):window.location.href=dataURI.replace("image/png","image/octet-stream")):"SVG"===_this.options.renderer&&(dataURI="data:image/svg+xml,"+_this.element.parentElement.innerHTML,"download"in a?(a.href=dataURI,a.download="plot.svg",a.click()):window.location.href=dataURI.replace("image/svg+xml","image/octet-stream"))}),opts.contextMenu.fullscreen&&"requestFullScreen"in document.body&&(this.contextMenu.getElementsByClassName("MathLib_fullscreen")[0].onclick=function(){document.fullscreenElement?document.exitFullScreen():_this.container.requestFullScreen()}),opts.contextMenu.grid&&(this.contextMenu.getElementsByClassName("MathLib_grid_type")[0].onchange=function(){_this.options.grid.type="cartesian",_this.draw()},this.contextMenu.getElementsByClassName("MathLib_grid_type")[1].onchange=function(){_this.options.grid.type="polar",_this.draw()},this.contextMenu.getElementsByClassName("MathLib_grid_type")[2].onchange=function(){_this.options.grid.type=!1,_this.draw()})),fullscreenchange=function(){document.fullscreenElement?(_this.origWidth=_this.width,_this.origHeight=_this.height,_this.resize(window.outerWidth,window.outerHeight)):(_this.resize(_this.origWidth,_this.origHeight),delete _this.origWidth,delete _this.origHeight)},"onfullscreenchange"in this.container?this.container.addEventListener("fullscreenchange",fullscreenchange):"onmozfullscreenchange"in this.container?this.container.addEventListener("mozfullscreenchange",fullscreenchange):"onwebkitfullscreenchange"in this.container&&this.container.addEventListener("webkitfullscreenchange",fullscreenchange)}return Screen.prototype.oncontextmenu=function(evt){var listener,_this=this,menu=this.contextMenu,overlay=this.contextMenuOverlay;evt.preventDefault&&evt.preventDefault(),evt.returnValue=!1,menu.style.setProperty("top",evt.clientY-20+"px"),menu.style.setProperty("left",evt.clientX+"px"),overlay.style.setProperty("display","block"),listener=function(){overlay.style.setProperty("display","none"),Array.prototype.forEach.call(_this.contextMenu.getElementsByClassName("MathLib_temporaryMenuItem"),function(x){_this.contextMenu.removeChild(x)}),overlay.removeEventListener("click",listener)},overlay.addEventListener("click",listener)},Screen}();MathLib.Screen=Screen;var Layer=function(){function Layer(screen,id,zIndex){var _this=this;this.screen=screen,this.id=id,this.zIndex=zIndex,this.stack=[],this.transformation=screen.transformation;var element;if("Canvas"===screen.options.renderer)element=document.createElement("canvas"),element.classList.add("MathLib_screen"),element.width=screen.width,element.height=screen.height,screen.wrapper.appendChild(element),this.element=element,this.ctx=element.getContext("2d"),this.applyTransformation=function(){var m=_this.transformation;_this.ctx.setTransform(m[0][0],m[1][0],m[0][1],m[1][1],m[0][2],m[1][2])},this.applyTransformation(),"back"===id?this.draw=function(){var top=-screen.translation.y/screen.scale.y,bottom=(screen.height-screen.translation.y)/screen.scale.y,left=-screen.translation.x/screen.scale.x,right=(screen.width-screen.translation.x)/screen.scale.x;this.ctx.fillStyle=colorConvert(screen.options.background),this.ctx.fillRect(left,bottom,right-left,top-bottom),this.stack.forEach(function(x){"text"===x.type&&_this.text(x.object,x.x,x.y,x.options,!0),"pixel"===x.type?_this.pixel(x.object,x.t,x.r,x.b,x.l,x.options,!0):_this[x.type](x.object,x.options,!0)})}:"grid"===id?(this.ctx.strokeStyle=colorConvert(screen.options.grid.color)||"#cccccc",this.ctx.fillStyle="rgba(255,255,255,0)",this.draw=function(){_this.ctx.lineWidth=4/(screen.scale.x-screen.scale.y),_this.screen.drawGrid()}):"axis"===id?(console.log(screen.options.axis.color),this.ctx.strokeStyle=colorConvert(screen.options.axis.color)||"#000000",this.draw=function(){_this.ctx.lineWidth=4/(screen.scale.x-screen.scale.y),_this.screen.drawAxis()}):(this.ctx.strokeStyle="#000000",this.ctx.fillStyle="rgba(255,255,255,0)",this.draw=function(){_this.ctx.lineWidth=4/(screen.scale.x-screen.scale.y),this.stack.forEach(function(x){"text"===x.type&&_this.text(x.object,x.x,x.y,x.options,!0),"pixel"===x.type?_this.pixel(x.object,x.t,x.r,x.b,x.l,x.options,!0):_this[x.type](x.object,x.options,!0)
})}),this.circle=MathLib.Canvas.circle,this.line=MathLib.Canvas.line,this.path=MathLib.Canvas.path,this.pixel=MathLib.Canvas.pixel,this.point=MathLib.Canvas.point,this.text=MathLib.Canvas.text;else if("SVG"===screen.options.renderer){var ctx=document.createElementNS("http://www.w3.org/2000/svg","g"),m=screen.transformation;ctx.setAttribute("transform","matrix("+m[0][0]+","+m[1][0]+","+m[0][1]+","+m[1][1]+","+m[0][2]+","+m[1][2]+")"),screen.element.appendChild(ctx),this.ctx=ctx,"back"===id?this.draw=function(){-screen.translation.y/screen.scale.y,(screen.height-screen.translation.y)/screen.scale.y,-screen.translation.x/screen.scale.x,(screen.width-screen.translation.x)/screen.scale.x,this.stack.forEach(function(x){"text"===x.type&&_this.text(x.object,x.x,x.y,x.options,!0),"pixel"===x.type?_this.pixel(x.object,x.t,x.r,x.b,x.l,x.options,!0):_this[x.type](x.object,x.options,!0)})}:"grid"===id?(ctx.setAttribute("stroke",colorConvert(screen.options.grid.color)||"#cccccc"),this.draw=function(){ctx.setAttribute("stroke-width",4/(screen.scale.x-screen.scale.y)+""),_this.screen.drawGrid()}):"axis"===id?(ctx.setAttribute("stroke",colorConvert(screen.options.axis.color)||"#000000"),this.draw=function(){ctx.setAttribute("stroke-width",4/(screen.scale.x-screen.scale.y)+""),_this.screen.drawAxis()}):this.draw=function(){this.stack.forEach(function(x){"text"===x.type&&_this.text(x.object,x.x,x.y,x.options,!0),"pixel"===x.type?_this.pixel(x.object,x.t,x.r,x.b,x.l,x.options,!0):_this[x.type](x.object,x.options,!0)})},this.circle=MathLib.SVG.circle,this.line=MathLib.SVG.line,this.path=MathLib.SVG.path,this.pixel=MathLib.SVG.pixel,this.point=MathLib.SVG.point,this.text=MathLib.SVG.text}screen.layer.splice(zIndex,0,this)}return Layer.prototype.clear=function(){return this.screen.renderer.clear(this),this},Layer}();MathLib.Layer=Layer,MathLib.Canvas={applyTransformation:function(){var m=this.transformation;this.layer.forEach(function(l){l.ctx.setTransform(m[0][0],m[1][0],m[0][1],m[1][1],m[0][2],m[1][2])})},circle:function(circle,options,redraw){options===void 0&&(options={}),redraw===void 0&&(redraw=!1);var prop,opts,screen=this.screen,ctx=this.ctx;if(ctx.save(),ctx.lineWidth=(options.lineWidth||4)/(screen.scale.x-screen.scale.y),options){opts=MathLib.Canvas.convertOptions(options);for(prop in opts)opts.hasOwnProperty(prop)&&(ctx[prop]=opts[prop]);"setLineDash"in ctx&&ctx.setLineDash("dash"in options?options.dash:[]),"lineDashOffset"in ctx&&(ctx.lineDashOffset="dashOffset"in options?options.dashOffset:0)}return ctx.beginPath(),ctx.arc(circle.center[0],circle.center[1],circle.radius,0,2*Math.PI),ctx.closePath(),ctx.fill(),ctx.stroke(),ctx.restore(),redraw||this.stack.push({type:"circle",object:circle,options:options}),this},clear:function(layer){var screen=layer.screen,left=-screen.translation.x/screen.scale.x,top=-screen.translation.y/screen.scale.y,width=screen.width/screen.scale.x,height=screen.height/screen.scale.y;console.dir(layer),layer.ctx.clearRect(left,top,width,height)},convertOptions:function(opt){var res={};return"fillColor"in opt?res.fillStyle=colorConvert(opt.fillColor):"color"in opt&&(res.fillStyle=colorConvert(opt.color)),"font"in opt&&(res["font-family"]=opt.font),"fontSize"in opt&&(res["font-size"]=opt.fontSize),"lineColor"in opt?res.strokeStyle=colorConvert(opt.lineColor):"color"in opt&&(res.strokeStyle=colorConvert(opt.color)),res},line:function(line,options,redraw){options===void 0&&(options={}),redraw===void 0&&(redraw=!1);var prop,opts,screen=this.screen,points=this.screen.getLineEndPoints(line),ctx=this.ctx;if(ctx.save(),ctx.lineWidth=(options.lineWidth||4)/(screen.scale.x-screen.scale.y),options){opts=MathLib.Canvas.convertOptions(options);for(prop in opts)opts.hasOwnProperty(prop)&&(ctx[prop]=opts[prop]);"setLineDash"in ctx&&ctx.setLineDash("dash"in options?options.dash:[]),"lineDashOffset"in ctx&&(ctx.lineDashOffset="dashOffset"in options?options.dashOffset:0)}return ctx.beginPath(),ctx.moveTo(points[0][0],points[0][1]),ctx.lineTo(points[1][0],points[1][1]),ctx.stroke(),ctx.closePath(),ctx.restore(),redraw||this.stack.push({type:"line",object:line,options:options}),this},path:function(curve,options,redraw){options===void 0&&(options={}),redraw===void 0&&(redraw=!1);var prop,opts,path,x,y,i,from,to,screen=this.screen,ctx=this.ctx,step=2/(screen.scale.x-screen.scale.y);if(from=("from"in options?options.from:-screen.translation.x/screen.scale.x)-step,to=("to"in options?options.to:(screen.width-screen.translation.x)/screen.scale.x)+step,ctx.save(),ctx.lineWidth=(options.lineWidth||4)/(screen.scale.x-screen.scale.y),options){opts=MathLib.Canvas.convertOptions(options);for(prop in opts)opts.hasOwnProperty(prop)&&(ctx[prop]=opts[prop]);"setLineDash"in ctx&&ctx.setLineDash("dash"in options?options.dash:[]),"lineDashOffset"in ctx&&(ctx.lineDashOffset="dashOffset"in options?options.dashOffset:0)}if("function"==typeof curve)for(path=[],i=from;to>=i;i+=step)path.push([i,curve(i)]);else if("function"==typeof curve[0])for(path=[],x=curve[0],y=curve[1],i=from;to>=i;i+=step)path.push([x(i),y(i)]);else path=curve;return ctx.beginPath(),ctx.moveTo(path[0][0],path[0][1]),path.forEach(function(x){ctx.lineTo(x[0],x[1])}),ctx.stroke(),ctx.closePath(),ctx.restore(),redraw||this.stack.push({type:"path",object:curve,options:options}),this},pixel:function(f,t,r,b,l,options,redraw){options===void 0&&(options={}),redraw===void 0&&(redraw=!1);var x,y,i,screen=this.screen,top=-screen.translation.y/screen.scale.y,bottom=(screen.height-screen.translation.y)/screen.scale.y,left=-screen.translation.x/screen.scale.x,right=(screen.width-screen.translation.x)/screen.scale.x,ctx=this.ctx;t=Math.min(top,t),r=Math.min(right,r),b=Math.max(bottom,b),l=Math.max(left,l);var pxl,tPxl=Math.floor(-t*screen.scale.y),rPxl=Math.floor(r*screen.scale.x),bPxl=Math.floor(-b*screen.scale.y),lPxl=Math.floor(l*screen.scale.x),w=rPxl-lPxl,h=bPxl-tPxl,imgData=ctx.createImageData(w,h);for(y=tPxl,i=0;y>bPxl;y--)for(x=lPxl;rPxl>x;x++,i++)pxl=f(x/screen.scale.x,y/screen.scale.y),imgData.data[4*i]=pxl[0],imgData.data[4*i+1]=pxl[1],imgData.data[4*i+2]=pxl[2],imgData.data[4*i+3]=pxl[3];return ctx.putImageData(imgData,(left-l)*screen.scale.x,(t-top)*screen.scale.y),redraw||this.stack.push({type:"pixel",object:f,t:t,r:r,b:b,l:l,options:options}),this},point:function(point,options,redraw){options===void 0&&(options={}),redraw===void 0&&(redraw=!1);var prop,opts,dist,screen=this.screen,ctx=this.ctx;if(ctx.save(),ctx.lineWidth=(options.lineWidth||4)/(screen.scale.x-screen.scale.y),options){opts=MathLib.Canvas.convertOptions(options),"fillColor"in options||"color"in options||(opts.fillStyle="black");for(prop in opts)opts.hasOwnProperty(prop)&&(ctx[prop]=opts[prop]);"setLineDash"in ctx&&ctx.setLineDash("dash"in options?options.dash:[]),"lineDashOffset"in ctx&&(ctx.lineDashOffset="dashOffset"in options?options.dashOffset:0)}return ctx.beginPath(),ctx.arc(point[0]/point[2],point[1]/point[2],(options.size||10)/(screen.scale.x-screen.scale.y),0,2*Math.PI),ctx.closePath(),ctx.fill(),ctx.stroke(),ctx.restore(),options.label&&(dist=1.75*(options.size||10)+.75*(options.lineWidth||4),screen.text(options.label,point[0]/point[2]+dist/(screen.scale.x-screen.scale.y),point[1]/point[2]+dist/(screen.scale.x-screen.scale.y),{},!0)),redraw||this.stack.push({type:"point",object:point,options:options}),this},text:function(str,x,y,options,redraw){options===void 0&&(options={}),redraw===void 0&&(redraw=!1);var ctx,prop,opts,defaults={font:"Helvetica",fontSize:10,fillColor:"rgba(0, 0, 0, 1)",lineColor:"rgba(0, 0, 0, 1)",lineWidth:.05};ctx=this.ctx,opts=MathLib.Canvas.convertOptions(extendObject(defaults,options));for(prop in opts)opts.hasOwnProperty(prop)&&(ctx[prop]=opts[prop]);ctx.font="10px Helvetica",ctx.textAlign="center",ctx.textBaseline="middle";var tf=this.screen.transformation;return ctx.save(),ctx.transform(1/tf[0][0],0,0,1/tf[1][1],0,0),ctx.fillText(str,tf[0][0]*x,tf[1][1]*y),ctx.restore(),redraw||this.stack.push({type:"text",object:str,x:x,y:y,options:options}),this}},MathLib.SVG={applyTransformation:function(){var m=this.transformation;this.layer.forEach(function(l){l.ctx.setAttribute("transform","matrix("+m[0][0]+","+m[1][0]+","+m[0][1]+","+m[1][1]+","+m[0][2]+","+m[1][2]+")")})},circle:function(circle,options,redraw){options===void 0&&(options={}),redraw===void 0&&(redraw=!1);var prop,opts,screen=this.screen,svgCircle=document.createElementNS("http://www.w3.org/2000/svg","circle");if(svgCircle.setAttribute("cx",circle.center[0]),svgCircle.setAttribute("cy",circle.center[1]),svgCircle.setAttribute("r",circle.radius),options){svgCircle.setAttribute("stroke-width",(options.lineWidth||4)/(screen.scale.x-screen.scale.y)+""),opts=MathLib.SVG.convertOptions(options);for(prop in opts)opts.hasOwnProperty(prop)&&svgCircle.setAttribute(prop,opts[prop])}return this.ctx.appendChild(svgCircle),redraw||this.stack.push({type:"circle",object:circle,options:options}),this},clear:function(layer){layer.ctx.textContent=""},convertOptions:function(opt){var res={};return"fillColor"in opt?res.fill=colorConvert(opt.fillColor):"color"in opt&&(res.fill=colorConvert(opt.color)),"font"in opt&&(res["font-family"]=opt.font),"fontSize"in opt&&(res["font-size"]=opt.fontSize),"size"in opt&&(res.size=opt.size),"lineColor"in opt?res.stroke=colorConvert(opt.lineColor):"color"in opt&&(res.stroke=colorConvert(opt.color)),"dash"in opt&&0!==opt.dash.length&&(res["stroke-dasharray"]=opt.dash),"dashOffset"in opt&&0!==opt.dashOffset&&(res["stroke-dashoffset"]=opt.dashOffset),res},line:function(line,options,redraw){options===void 0&&(options={}),redraw===void 0&&(redraw=!1);var prop,opts,screen=this.screen,points=this.screen.getLineEndPoints(line),svgLine=document.createElementNS("http://www.w3.org/2000/svg","line");if(svgLine.setAttribute("x1",points[0][0]),svgLine.setAttribute("y1",points[0][1]),svgLine.setAttribute("x2",points[1][0]),svgLine.setAttribute("y2",points[1][1]),options){svgLine.setAttribute("stroke-width",(options.lineWidth||4)/(screen.scale.x-screen.scale.y)+""),opts=MathLib.SVG.convertOptions(options);for(prop in opts)opts.hasOwnProperty(prop)&&svgLine.setAttribute(prop,opts[prop])}return this.ctx.appendChild(svgLine),redraw||this.stack.push({type:"line",object:line,options:options}),this},path:function(curve,options,redraw){options===void 0&&(options={}),redraw===void 0&&(redraw=!1);var pathString,from,to,prop,opts,x,y,i,path,screen=this.screen,svgPath=document.createElementNS("http://www.w3.org/2000/svg","path"),step=2/(screen.scale.x-screen.scale.y);if(from=("from"in options?options.from:-screen.translation.x/screen.scale.x)-step,to=("to"in options?options.to:(screen.width-screen.translation.x)/screen.scale.x)+step,"function"==typeof curve)for(path=[],i=from;to>=i;i+=step)path.push([i,curve(i)]);else if("function"==typeof curve[0])for(path=[],x=curve[0],y=curve[1],i=from;to>=i;i+=step)path.push([x(i),y(i)]);else path=curve;if(pathString="M"+path.reduce(function(prev,cur){return prev+" L"+cur.join(" ")}),svgPath.setAttribute("d",pathString),svgPath.setAttribute("stroke-width",(options.lineWidth||4)/(screen.scale.x-screen.scale.y)+""),options){opts=MathLib.SVG.convertOptions(options);for(prop in opts)opts.hasOwnProperty(prop)&&svgPath.setAttribute(prop,opts[prop])}return this.ctx.appendChild(svgPath),redraw||this.stack.push({type:"path",object:curve,options:options}),this},pixel:function(f,t,r,b,l,options,redraw){options===void 0&&(options={}),redraw===void 0&&(redraw=!1);var x,y,i,pxl,screen=this.screen,top=-screen.translation.y/screen.scale.y,bottom=(screen.height-screen.translation.y)/screen.scale.y,left=-screen.translation.x/screen.scale.x,right=(screen.width-screen.translation.x)/screen.scale.x,canvas=(this.ctx,document.createElement("canvas")),canvasCtx=canvas.getContext("2d"),svgImage=document.createElementNS("http://www.w3.org/2000/svg","image"),svgContainer=document.createElementNS("http://www.w3.org/2000/svg","g"),m=screen.transformation;canvas.width=screen.width,canvas.height=screen.height,canvasCtx.setTransform(m[0][0],m[1][0],m[0][1],m[1][1],m[0][2],m[1][2]),svgContainer.setAttribute("transform","matrix("+1/m[0][0]+",0,0,"+1/m[1][1]+",-"+m[0][2]/m[0][0]+","+-m[1][2]/m[1][1]+")"),svgImage.setAttribute("width",screen.width+"px"),svgImage.setAttribute("height",screen.height+"px"),svgImage.setAttribute("x","0"),svgImage.setAttribute("y","0"),t=Math.min(top,t),r=Math.min(right,r),b=Math.max(bottom,b),l=Math.max(left,l);var tPxl=Math.floor(-t*screen.scale.y),rPxl=Math.floor(r*screen.scale.x),bPxl=Math.floor(-b*screen.scale.y),lPxl=Math.floor(l*screen.scale.x),w=rPxl-lPxl,h=tPxl-bPxl,imgData=canvasCtx.createImageData(w,h);for(y=tPxl,i=0;y>bPxl;y--)for(x=lPxl;rPxl>x;x++,i++)pxl=f(x/screen.scale.x,y/screen.scale.y),imgData.data[4*i]=pxl[0],imgData.data[4*i+1]=pxl[1],imgData.data[4*i+2]=pxl[2],imgData.data[4*i+3]=pxl[3];return canvasCtx.putImageData(imgData,0,0),svgImage.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",canvas.toDataURL()),svgContainer.appendChild(svgImage),this.ctx.appendChild(svgContainer),redraw||this.stack.push({type:"pixel",object:f,t:t,r:r,b:b,l:l,options:options}),this},point:function(point,options,redraw){options===void 0&&(options={}),redraw===void 0&&(redraw=!1);var prop,opts,dist,screen=this.screen,svgPoint=document.createElementNS("http://www.w3.org/2000/svg","circle");if(svgPoint.setAttribute("cx",point[0]/point[2]+""),svgPoint.setAttribute("cy",point[1]/point[2]+""),svgPoint.setAttribute("r",(options.size||10)/(screen.scale.x-screen.scale.y)+""),options){svgPoint.setAttribute("stroke-width",(options.lineWidth||4)/(screen.scale.x-screen.scale.y)+""),opts=MathLib.SVG.convertOptions(options),"fillOpacity"in options||(opts["fill-opacity"]="1"),"fillColor"in options||"color"in options||(opts.fill="black");for(prop in opts)opts.hasOwnProperty(prop)&&svgPoint.setAttribute(prop,opts[prop])}return options.moveable&&(svgPoint.setAttribute("cursor","move"),svgPoint.addEventListener("mousedown",function(){screen.options.interaction.type="move";var invTransformation=screen.transformation.inverse(),move=function(evt){evt.stopPropagation();var evtPoint=invTransformation.times(screen.getEventPoint(evt));point[0]=evtPoint[0],point[1]=evtPoint[1],screen.draw()},up=function(){screen.options.interaction.type="",document.body.removeEventListener("mousemove",move),document.body.removeEventListener("mouseup",up)};document.body.addEventListener("mousemove",move),document.body.addEventListener("mouseup",up)})),this.ctx.appendChild(svgPoint),options.label&&(dist=1.75*(options.size||10)+.75*(options.lineWidth||4),screen.text(options.label,point[0]/point[2]+dist/(screen.scale.x-screen.scale.y),point[1]/point[2]+dist/(screen.scale.x-screen.scale.y),{},!0)),svgPoint.addEventListener("contextmenu",function(){screen.options.interaction.type="contextmenu";var x=svgPoint.cx.baseVal.value,y=svgPoint.cy.baseVal.value;screen.contextMenu.innerHTML='<div class="MathLib_menuItem MathLib_temporaryMenuItem MathLib_is_disabled MathLib_is_centered">Point</div><div class="MathLib_menuItem MathLib_temporaryMenuItem MathLib_hasSubmenu">Coordinates<menu class="MathLib_menu MathLib_submenu"><div class="MathLib_menuItem">cartesian: <span class="MathLib_is_selectable MathLib_is_right">('+x.toFixed(3)+", "+y.toFixed(3)+")</span></div>"+'<div class="MathLib_menuItem">polar: <span class="MathLib_is_selectable MathLib_is_right">('+MathLib.hypot(x,y).toFixed(3)+", "+Math.atan2(y,x).toFixed(3)+")</span></div>"+"</menu>"+"</div>"+'<div class="MathLib_menuItem MathLib_temporaryMenuItem MathLib_hasSubmenu">Options'+'<menu class="MathLib_menu MathLib_submenu">'+'<div class="MathLib_menuItem">Moveable:'+'<input type="checkbox" class="MathLib_is_right">'+"</div>"+'<div class="MathLib_menuItem">Size:'+'<input type="spinner" class="MathLib_is_right">'+"</div>"+'<div class="MathLib_menuItem">Fill color:'+'<input type="color" class="MathLib_is_right">'+"</div>"+'<div class="MathLib_menuItem">Line color:'+'<input type="color" class="MathLib_is_right">'+"</div>"+"</menu>"+"</div>"+'<hr class="MathLib_separator MathLib_temporaryMenuItem">'+screen.contextMenu.innerHTML}),redraw||this.stack.push({type:"point",object:point,options:options}),this},text:function(str,x,y,options,redraw){options===void 0&&(options={}),redraw===void 0&&(redraw=!1);var screen=this.screen,svgText=document.createElementNS("http://www.w3.org/2000/svg","text");return this.ctx,this.screen.transformation,svgText.textContent=str,svgText.setAttribute("x",x*screen.scale.x+""),svgText.setAttribute("y",y*screen.scale.y+""),svgText.setAttribute("transform","matrix("+1/screen.scale.x+", 0, 0, "+1/screen.scale.y+", 0, 0)"),svgText.setAttribute("font-family","Helvetica"),svgText.setAttribute("fill",colorConvert(options.color)||"#000000"),svgText.setAttribute("fill-opacity","1"),svgText.setAttribute("stroke",colorConvert(options.color)||"#000000"),svgText.setAttribute("text-anchor","middle"),svgText.setAttribute("alignment-baseline","middle"),this.ctx.appendChild(svgText),redraw||this.stack.push({type:"text",object:str,x:x,y:y,options:options}),this}};var Screen2D=function(_super){function Screen2D(id,options){options===void 0&&(options={});var _this=this;_super.call(this,id,options),this.type="screen2D";var element,defaults={axis:{color:0,textColor:0,tick:{x:1,y:1}},grid:{angle:Math.PI/8,color:13421772,type:"cartesian",tick:{x:1,y:1,r:1}},interaction:{allowPan:!0,allowZoom:!0,zoomSpeed:1},background:16777215,lookAt:{x:0,y:0},range:{x:1,y:1},figcaption:"",renderer:"Canvas",transformation:new MathLib.Matrix([[Math.min(this.height,this.width)/2,0,this.width/2],[0,-Math.min(this.height,this.width)/2,this.height/2],[0,0,1]])},opts=extendObject(defaults,options),transformation=opts.transformation,_this=this;if(this.options=opts,this.renderer=MathLib[opts.renderer],this.circle=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return _this.renderer.circle.apply(_this.layer.main,args)},this.line=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return _this.renderer.line.apply(_this.layer.main,args)},this.path=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return _this.renderer.path.apply(_this.layer.main,args)},this.pixel=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return _this.renderer.pixel.apply(_this.layer.main,args)},this.point=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return _this.renderer.point.apply(_this.layer.main,args)},this.text=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return _this.renderer.text.apply(_this.layer.main,args)},this.wrapper.innerHTML="",this.container.classList.add("MathLib_screen2D"),this.applyTransformation=function(){},this.translation={},this.scale={},this.transformation=transformation,Object.defineProperty(this.translation,"x",{get:function(){return _this.transformation[0][2]},set:function(x){_this.transformation[0][2]=x,_this.applyTransformation()}}),Object.defineProperty(this.translation,"y",{get:function(){return _this.transformation[1][2]},set:function(y){_this.transformation[1][2]=y,_this.applyTransformation()}}),Object.defineProperty(this.scale,"x",{get:function(){return _this.transformation[0][0]},set:function(x){_this.transformation[0][0]=x,_this.applyTransformation()}}),Object.defineProperty(this.scale,"y",{get:function(){return _this.transformation[1][1]},set:function(y){_this.transformation[1][1]=y,_this.applyTransformation()}}),this.lookAt={},this.range={},Object.defineProperty(this.lookAt,"x",{get:function(){return(_this.width/2-_this.transformation[0][2])/_this.transformation[0][0]},set:function(x){_this.transformation[0][2]=_this.width/2-x*_this.transformation[0][0],_this.applyTransformation()}}),Object.defineProperty(this.lookAt,"y",{get:function(){return(_this.height/2-_this.transformation[1][2])/_this.transformation[1][1]},set:function(y){_this.transformation[1][2]=_this.height/2-y*_this.transformation[1][1],_this.applyTransformation()}}),Object.defineProperty(this.range,"x",{get:function(){return _this.width/(2*_this.transformation[0][0])},set:function(x){_this.transformation[0][0]=.5*_this.width/x,_this.applyTransformation()}}),Object.defineProperty(this.range,"y",{get:function(){return-_this.height/(2*_this.transformation[1][1])},set:function(y){_this.transformation[1][1]=-.5*_this.height/y,_this.applyTransformation()}}),this.range.x=opts.range.x,this.range.y=opts.range.y,this.lookAt.x=opts.lookAt.x,this.lookAt.y=opts.lookAt.y,"SVG"===opts.renderer&&(element=document.createElementNS("http://www.w3.org/2000/svg","svg"),element.className.baseVal="MathLib_screen",element.setAttribute("xmlns","http://www.w3.org/2000/svg"),element.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),element.setAttribute("height",this.height+"px"),element.setAttribute("width",this.width+"px"),element.setAttribute("version","1.1"),element.setAttribute("stroke","#000000"),element.setAttribute("stroke-opacity","1"),element.setAttribute("fill","#ffffff"),element.setAttribute("fill-opacity","0"),this.element=element,this.wrapper.appendChild(element),"background"in options)){var background=document.createElementNS("http://www.w3.org/2000/svg","rect");background.setAttribute("x","0px"),background.setAttribute("y","0px"),background.setAttribute("width",this.width+"px"),background.setAttribute("height",this.height+"px"),background.setAttribute("fill",colorConvert(options.background)),background.setAttribute("fill-opacity","1"),this.element.appendChild(background)}if(this.layer=[],this.layer.back=new MathLib.Layer(this,"back",0),this.layer.grid=new MathLib.Layer(this,"grid",1),this.layer.axis=new MathLib.Layer(this,"axis",2),this.layer.main=new MathLib.Layer(this,"main",3),this.wrapper.addEventListener("mouseup",function(evt){return _this.onmouseup(evt)},!1),this.wrapper.addEventListener("mousedown",function(evt){return _this.onmousedown(evt)},!1),this.wrapper.addEventListener("mousemove",function(evt){return _this.onmousemove(evt)},!1),this.wrapper.addEventListener("mousewheel",function(evt){return _this.onmousewheel(evt)},!1),this.wrapper.addEventListener("DOMMouseScroll",function(evt){return _this.onmousewheel(evt)},!1),this.applyTransformation=this.renderer.applyTransformation,this.draw=function(x,options){options===void 0&&(options={});var _this=this;0===arguments.length?this.layer.forEach(function(l){l.clear().draw()}):"circle"===x.type?this.circle(x,options):"line"===x.type?this.line(x,options):Array.isArray(x)&&x.forEach(function(y){return _this[y.type](y,options)})},this.options.contextMenu){var gridType=opts.grid.type?opts.grid.type:"none";this.contextMenu.querySelectorAll(".MathLib_grid_type[value="+gridType+"]")[0].checked=!0}this.draw()}return __extends(Screen2D,_super),Screen2D.prototype.resize=function(width,height){return this.height=height,this.width=width,"Canvas"===this.options.renderer?(this.layer.back.element.width=width,this.layer.back.element.height=height,this.layer.back.ctx.fillStyle="rgba(255, 255, 255, 0)",this.layer.grid.element.width=width,this.layer.grid.element.height=height,this.layer.grid.ctx.fillStyle="rgba(255, 255, 255, 0)",this.layer.grid.ctx.strokeStyle=colorConvert(this.options.grid.color)||"#cccccc",this.layer.axis.element.width=width,this.layer.axis.element.height=height,this.layer.axis.ctx.fillStyle="rgba(255, 255, 255, 0)",this.layer.axis.ctx.strokeStyle=colorConvert(this.options.axis.color)||"#000000",this.layer.main.element.width=width,this.layer.main.element.height=height,this.layer.main.ctx.fillStyle="rgba(255, 255, 255, 0)"):"SVG"===this.options.renderer&&(this.element.setAttribute("width",width+"px"),this.element.setAttribute("height",height+"px")),this.applyTransformation(),this.draw(),this},Screen2D.prototype.getEventPoint=function(evt){var x,y;return evt.offsetX?(x=evt.offsetX,y=evt.offsetY):(x=evt.layerX,y=evt.layerY),new MathLib.Point([x,y,1])},Screen2D.prototype.getLineEndPoints=function(l){if("line"===l.type){var top=-this.translation.y/this.scale.y,bottom=(this.height-this.translation.y)/this.scale.y,left=-this.translation.x/this.scale.x,right=(this.width-this.translation.x)/this.scale.x,lineRight=-(l[2]+l[0]*right)/l[1],lineTop=-(l[2]+l[1]*top)/l[0],lineLeft=-(l[2]+l[0]*left)/l[1],lineBottom=-(l[2]+l[1]*bottom)/l[0],res=[];return top>=lineRight&&lineRight>=bottom&&res.push([right,lineRight]),top>=lineLeft&&lineLeft>=bottom&&res.push([left,lineLeft]),right>lineTop&&lineTop>left&&res.push([lineTop,top]),right>lineBottom&&lineBottom>left&&res.push([lineBottom,bottom]),res}return l},Screen2D.prototype.drawGrid=function(){var _this=this;if(!this.options.grid)return this;var i,line=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return _this.renderer.line.apply(_this.layer.grid,args)},circle=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return _this.renderer.circle.apply(_this.layer.grid,args)},top=-this.translation.y/this.scale.y,bottom=(this.height-this.translation.y)/this.scale.y,left=-this.translation.x/this.scale.x,right=(this.width-this.translation.x)/this.scale.x,yTick=Math.pow(10,1-Math.floor(Math.log(-this.transformation[1][1])/Math.LN10-.3)),xTick=Math.pow(10,1-Math.floor(Math.log(+this.transformation[0][0])/Math.LN10-.3));if("cartesian"===this.options.grid.type){for(i=bottom-bottom%yTick;top>=i;i+=yTick)line([[left,i],[right,i]],!1,!0);for(i=left-left%xTick;right>=i;i+=xTick)line([[i,bottom],[i,top]],!1,!0)}else if("polar"===this.options.grid.type){var max=Math.sqrt(Math.max(top*top,bottom*bottom)+Math.max(left*left,right*right)),min=0;for(i=0;2*Math.PI>i;i+=this.options.grid.angle)line([[0,0],[max*Math.cos(i),max*Math.sin(i)]],!1,!0);for(i=min;max>=i;i+=Math.min(xTick,yTick))circle(new MathLib.Circle([0,0,1],i),!1,!0)}return this},Screen2D.prototype.drawAxis=function(){var i,_this=this,line=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return _this.renderer.line.apply(_this.layer.axis,args)},text=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return _this.renderer.text.apply(_this.layer.axis,args)},options={lineColor:colorConvert(this.options.axis.color),"stroke-width":-1/this.transformation[1][1]},textOptions={strokeStyle:colorConvert(this.options.axis.textColor),fillStyle:colorConvert(this.options.axis.textColor)},top=-this.translation.y/this.scale.y,bottom=(this.height-this.translation.y)/this.scale.y,left=-this.translation.x/this.scale.x,right=(this.width-this.translation.x)/this.scale.x,lengthX=10/this.transformation[0][0],lengthY=-10/this.transformation[1][1],yExp=1-Math.floor(Math.log(-this.transformation[1][1])/Math.LN10-.3),xExp=1-Math.floor(Math.log(+this.transformation[0][0])/Math.LN10-.3),yTick=Math.pow(10,yExp),xTick=Math.pow(10,xExp);if(!this.options.axis)return this;if(line([[left,0],[right,0]],options,!0),line([[0,bottom],[0,top]],options,!0),this.options.grid.tick){for(i=-yTick;i>=left;i-=yTick)line([[i,-lengthY],[i,lengthY]],options,!0);for(i=yTick;right>=i;i+=yTick)line([[i,-lengthY],[i,lengthY]],options,!0);for(i=-xTick;i>=bottom;i-=xTick)line([[-lengthX,i],[lengthX,i]],options,!0);for(i=xTick;top>=i;i+=xTick)line([[-lengthX,i],[lengthX,i]],options,!0)}var xLen=Math.max(0,Math.min(20,-xExp)),yLen=Math.max(0,Math.min(20,-yExp));for(i=-yTick;i>=left;i-=yTick)text(i.toFixed(yLen),i,-2*lengthY,textOptions,!0);for(i=yTick;right>=i;i+=yTick)text(i.toFixed(yLen),i,-2*lengthY,textOptions,!0);for(i=-xTick;i>=bottom;i-=xTick)text(i.toFixed(xLen),-2*lengthX,i,textOptions,!0);for(i=xTick;top>=i;i+=xTick)text(i.toFixed(xLen),-2*lengthX,i,textOptions,!0);return this},Screen2D.prototype.onmousedown=function(evt){0===evt.button&&(evt.preventDefault&&evt.preventDefault(),evt.returnValue=!1,this.options.interaction.allowPan&&!this.options.interaction.type&&(this.options.interaction.type="pan",this.options.interaction.startPoint=this.getEventPoint(evt),this.options.interaction.startTransformation=this.transformation.copy()))},Screen2D.prototype.onmousemove=function(evt){var p;evt.preventDefault&&evt.preventDefault(),evt.returnValue=!1,"pan"===this.options.interaction.type&&(p=this.getEventPoint(evt).minus(this.options.interaction.startPoint),this.translation.x=this.options.interaction.startTransformation[0][2]+p[0],this.translation.y=this.options.interaction.startTransformation[1][2]+p[1],this.draw())},Screen2D.prototype.onmouseup=function(evt){evt.preventDefault&&evt.preventDefault(),evt.returnValue=!1,"pan"===this.options.interaction.type&&(delete this.options.interaction.type,delete this.options.interaction.startPoint,delete this.options.interaction.startTransformation)},Screen2D.prototype.onmousewheel=function(evt){var delta,s,p,z;this.options.interaction.allowZoom&&(evt.preventDefault&&evt.preventDefault(),evt.returnValue=!1,delta=evt.wheelDelta?evt.wheelDelta/360:evt.detail/-9,z=Math.pow(1+this.options.interaction.zoomSpeed,delta),p=this.transformation.inverse().times(this.getEventPoint(evt)),s=new MathLib.Matrix([[z,0,p[0]-p[0]*z],[0,z,p[1]-p[1]*z],[0,0,1]]),this.transformation=this.transformation.times(s),this.applyTransformation(),this.draw())},Screen2D}(Screen);MathLib.Screen2D=Screen2D;var Screen3D=function(_super){function Screen3D(id,options){function animate(){requestAnimationFrame(animate),render(),update()}function update(){controls.update()}function render(){renderer.render(scene,camera)}options===void 0&&(options={}),_super.call(this,id,options),this.type="screen3D";var camera,renderer,controls,viewAngle,aspect,near,far,defaults={anaglyphMode:!1,axis:!0,background:16777215,camera:{lookAt:[0,0,0],position:[10,10,10]},controls:"Trackball",grid:{xy:{angle:Math.PI/8,color:13421772,type:"none",tick:{x:1,y:1,r:1}},xz:{angle:Math.PI/8,color:13421772,type:"none",tick:{x:1,z:1,r:1}},yz:{angle:Math.PI/8,color:13421772,type:"none",tick:{y:1,z:1,r:1}}},height:500,renderer:"WebGL",width:500},opts=extendObject(defaults,options),scene=new THREE.Scene;this.options=opts,this.scene=scene,viewAngle=45,aspect=opts.width/opts.height,near=.1,far=2e4,camera=new THREE.PerspectiveCamera(viewAngle,aspect,near,far),camera.position=to3js(opts.camera.position),camera.lookAt(to3js(opts.camera.lookAt)),camera.up=new THREE.Vector3(0,0,1),scene.add(camera),renderer=new THREE[opts.renderer+"Renderer"]({antialias:!0,preserveDrawingBuffer:!0}),this.wrapper.innerHTML="",this.wrapper.appendChild(renderer.domElement),opts.anaglyphMode&&(renderer=new THREE.AnaglyphEffect(renderer)),renderer.setSize(opts.width,opts.height),controls=opts.controls?new THREE[opts.controls+"Controls"](camera,renderer.domElement):{update:function(){}};var light1=new THREE.PointLight(16777215);light1.position.set(0,0,200),scene.add(light1);var light2=new THREE.PointLight(16777215);if(light2.position.set(0,0,-200),scene.add(light2),renderer.setClearColorHex(opts.background,1),renderer.clear(),opts.grid&&this.drawGrid(),opts.axis){var axis=new THREE.AxisHelper(10);scene.add(axis)}animate(),this.options=opts,this.element=renderer.domElement,this.renderer=renderer,this.camera=camera,this.container.classList.add("MathLib_screen3D")}return __extends(Screen3D,_super),Screen3D.prototype.drawGrid=function(){if(!this.options.grid)return this;var _this=this,gridDrawer=function(opts,rotX,rotY){var i,size=10,grid=new THREE.Object3D,color=new THREE.Color(opts.color);if("cartesian"===opts.type){var tickX="x"in opts.tick?opts.tick.x:opts.tick.y,tickY="z"in opts.tick?opts.tick.z:opts.tick.y,lines=new THREE.Shape;for(i=-size;size>=i;i+=tickX)lines.moveTo(-size,i),lines.lineTo(size,i);for(i=-size;size>=i;i+=tickY)lines.moveTo(i,-size),lines.lineTo(i,size);grid.add(new THREE.Line(lines.createPointsGeometry(),new THREE.LineBasicMaterial({color:color}),THREE.LinePieces)),grid.rotation.x=rotX,grid.rotation.y=rotY,_this.scene.add(grid)}else if("polar"===opts.type){var circles=new THREE.Shape,rays=new THREE.Shape;
for(i=0;size>=i;i+=opts.tick.r)circles.moveTo(i,0),circles.absarc(0,0,i,0,2*Math.PI+.001,!1);for(grid.add(new THREE.Line(circles.createPointsGeometry(),new THREE.LineBasicMaterial({color:color}))),i=0;2*Math.PI>=i;i+=opts.angle)rays.moveTo(0,0),rays.lineTo(size*Math.cos(i),size*Math.sin(i));grid.add(new THREE.Line(rays.createPointsGeometry(),new THREE.LineBasicMaterial({color:color}))),grid.rotation.x=rotX,grid.rotation.y=rotY,_this.scene.add(grid)}};return gridDrawer(this.options.grid.xy,0,0),gridDrawer(this.options.grid.xz,Math.PI/2,0),gridDrawer(this.options.grid.yz,0,Math.PI/2),this},Screen3D.prototype.parametricPlot3D=function(f,options){var defaults={closed:!1,debug:!1,min:0,max:1,pointNum:1e3,radius:.05,segmentsRadius:6,material:{type:"MeshLambert"}},opts=extendObject(defaults,options),curve=THREE.Curve.create(function(){},function(t){t=(opts.max-opts.min)*t+opts.min;var res=f(t);return new THREE.Vector3(res[0],res[1],res[2])}),mesh=new THREE.Mesh(new THREE.TubeGeometry(new curve,opts.pointNum,opts.radius,opts.segmentsRadius,opts.closed,opts.debug),new THREE[opts.material.type+"Material"](opts.material));return this.scene.add(mesh),this},Screen3D.prototype.plot3D=function(f,options){return this.surfacePlot3D(function(u,v){return[u,v,f(u,v)]},options)},Screen3D.prototype.resize=function(width,height){return this.renderer.setSize(width,height),this.camera.aspect=width/height,this.camera.updateProjectionMatrix(),this},Screen3D.prototype.surfacePlot3D=function(f,options){var mesh,defaults={material:{type:"MeshLambert"},pointNumX:100,pointNumY:100,xmin:0,xmax:1,ymin:0,ymax:1},opts=extendObject(defaults,options),map=function(u,v){u=(opts.xmax-opts.xmin)*u+opts.xmin,v=(opts.ymax-opts.ymin)*v+opts.ymin;var res=f(u,v);return new THREE.Vector3(res[0],res[1],res[2])},material=new THREE[opts.material.type+"Material"](opts.material);return material.side=THREE.DoubleSide,mesh=new THREE.Mesh(new THREE.ParametricGeometry(map,opts.pointNumX,opts.pointNumY,!1),material),this.scene.add(mesh),this},Screen3D}(Screen);MathLib.Screen3D=Screen3D;var Vector=function(){function Vector(coords){var _this=this;this.type="vector",coords.forEach(function(x,i){_this[i]=x}),this.length=coords.length}return Vector.areLinearIndependent=function(v){var n=v.length,m=v[0].length;return n>m?!1:v.every(function(x){return x.length===m})?new MathLib.Matrix(v).rank()===n:void 0},Vector.prototype.every=function(f){return Array.prototype.every.call(this,f)},Vector.prototype.forEach=function(f){Array.prototype.forEach.call(this,f)},Vector.prototype.isEqual=function(v){return this.length!==v.length?!1:this.every(function(x,i){return MathLib.isEqual(x,v[i])})},Vector.prototype.isZero=function(){return this.every(MathLib.isZero)},Vector.prototype.map=function(f){return new this.constructor(Array.prototype.map.call(this,f))},Vector.prototype.minus=function(v){return this.length===v.length?this.plus(v.negative()):void 0},Vector.prototype.negative=function(){return this.map(MathLib.negative)},Vector.prototype.norm=function(p){return p===void 0&&(p=2),2===p?MathLib.hypot.apply(null,this.toArray()):1/0===p?Math.max.apply(null,this.map(Math.abs).toArray()):MathLib.root(this.reduce(function(prev,curr){return prev+Math.pow(Math.abs(curr),p)},0),p)},Vector.prototype.outerProduct=function(v){return new MathLib.Matrix(this.map(function(x){return v.map(function(y){return MathLib.times(x,y)})}))},Vector.prototype.plus=function(v){return this.length===v.length?new MathLib.Vector(this.map(function(x,i){return MathLib.plus(x,v[i])})):void 0},Vector.prototype.reduce=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return Array.prototype.reduce.apply(this,args)},Vector.prototype.scalarProduct=function(v){return this.length===v.length?this.reduce(function(old,cur,i,w){return MathLib.plus(old,MathLib.times(w[i],v[i]))},0):void 0},Vector.prototype.slice=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return Array.prototype.slice.apply(this,args)},Vector.prototype.times=function(n){var i,ii,res=[];if("rational"===n.type&&(n=n.toNumber()),"number"==typeof n||"complex"===n.type)return this.map(function(x){return MathLib.times(n,x)});if("matrix"===n.type){for(res=n.toColVectors(),i=0,ii=res.length;ii>i;i++)res[i]=this.scalarProduct(res[i]);return new MathLib.Vector(res)}},Vector.prototype.toArray=function(){return Array.prototype.slice.call(this)},Vector.prototype.toContentMathMLString=function(){return this.reduce(function(old,cur){return old+MathLib.toContentMathMLString(cur)},"<vector>")+"</vector>"},Vector.prototype.toLaTeX=function(){return"\\begin{pmatrix}\n	"+this.reduce(function(old,cur){return old+"\\\\\n	"+MathLib.toLaTeX(cur)})+"\n\\end{pmatrix}"},Vector.prototype.toMathMLString=function(){return this.reduce(function(old,cur){return old+"<mtr><mtd>"+MathLib.toMathMLString(cur)+"</mtd></mtr>"},"<mrow><mo>(</mo><mtable>")+"</mtable><mo>)</mo></mrow>"},Vector.prototype.toString=function(){return"("+this.reduce(function(old,cur){return old+", "+MathLib.toString(cur)})+")"},Vector.prototype.vectorProduct=function(v){return 3===this.length&&3===v.length?new MathLib.Vector([MathLib.minus(MathLib.times(this[1],v[2]),MathLib.times(this[2],v[1])),MathLib.minus(MathLib.times(this[2],v[0]),MathLib.times(this[0],v[2])),MathLib.minus(MathLib.times(this[0],v[1]),MathLib.times(this[1],v[0]))]):void 0},Vector.zero=function(n){var i,res=[];for(i=0;n>i;i++)res.push(0);return new MathLib.Vector(res)},Vector}();MathLib.Vector=Vector;var Circle=function(){function Circle(center,radius){this.type="circle",void 0===center.type&&(center=new MathLib.Point(center.concat(1))),this.center=center,this.radius=radius}return Circle.prototype.area=function(){return this.radius*this.radius*Math.PI},Circle.prototype.circumference=function(){return 2*this.radius*Math.PI},Circle.prototype.draw=function(screen,options){if(Array.isArray(screen)){var circle=this;screen.forEach(function(x){x.circle(circle,options)})}else screen.circle(this,options);return this},Circle.prototype.isEqual=function(c){return MathLib.isEqual(this.radius,c.radius)&&this.center.isEqual(c.center)},Circle.prototype.positionOf=function(p){var diff;return"point"===p.type&&2===p.dimension?(diff=p.distanceTo(this.center)-this.radius,MathLib.isZero(diff)?"on":0>diff?"in":"out"):void 0},Circle.prototype.reflectAt=function(a){return new MathLib.Circle(this.center.reflectAt(a),this.radius)},Circle.prototype.toLaTeX=function(){return"B_{"+MathLib.toLaTeX(this.radius)+"}\\left("+this.center.toLaTeX()+"\\right)"},Circle.prototype.toMatrix=function(){var x=this.center[0]/this.center[2],y=this.center[1]/this.center[2],r=this.radius;return new MathLib.Matrix([[1,0,-x],[0,1,-y],[-x,-y,x*x+y*y-r*r]])},Circle}();MathLib.Circle=Circle;var Complex=function(){function Complex(re,im){im===void 0&&(im=0),this.type="complex",this.re=re,this.im=im}return Complex.infinity="complexInfinity",Complex.prototype.abs=function(){return MathLib.hypot(this.re,this.im)},Complex.prototype.arccos=function(){return MathLib.minus(Math.PI/2,this.arcsin())},Complex.prototype.arccot=function(){return MathLib.minus(Math.PI/2,this.arctan())},Complex.prototype.arccsc=function(){return MathLib.times(new MathLib.Complex(0,1),MathLib.ln(MathLib.plus(MathLib.sqrt(MathLib.minus(1,MathLib.divide(1,MathLib.times(this,this)))),MathLib.divide(new MathLib.Complex(0,1),this))))},Complex.prototype.arcsin=function(){var a=this.re,b=this.im;return new MathLib.Complex(MathLib.sign(a)/2*MathLib.arccos(Math.sqrt(Math.pow(a*a+b*b-1,2)+4*b*b)-(a*a+b*b)),MathLib.sign(b)/2*MathLib.arcosh(Math.sqrt(Math.pow(a*a+b*b-1,2)+4*b*b)+(a*a+b*b)))},Complex.prototype.arctan=function(){var iz=new MathLib.Complex(-this.im,this.re);return MathLib.times(new MathLib.Complex(0,.5),MathLib.ln(MathLib.divide(MathLib.plus(1,iz),MathLib.minus(1,iz))))},Complex.prototype.arg=function(){return Math.atan2(this.im,this.re)},Complex.prototype.artanh=function(){return MathLib.times(.5,MathLib.minus(MathLib.ln(MathLib.plus(1,this)),MathLib.ln(MathLib.minus(1,this))))},Complex.prototype.compare=function(x){var a=MathLib.sign(this.abs()-x.abs());return a?a:MathLib.sign(this.arg()-x.arg())},Complex.prototype.conjugate=function(){return new MathLib.Complex(this.re,MathLib.negative(this.im))},Complex.prototype.copy=function(){return new MathLib.Complex(MathLib.copy(this.re),MathLib.copy(this.im))},Complex.prototype.cos=function(){return new MathLib.Complex(MathLib.cos(this.re)*MathLib.cosh(this.im),-MathLib.sin(this.re)*MathLib.sinh(this.im))},Complex.prototype.cosh=function(){return new MathLib.Complex(MathLib.cos(this.im)*MathLib.cosh(this.re),MathLib.sin(this.im)*MathLib.sinh(this.re))},Complex.prototype.divide=function(c){return this.times(MathLib.inverse(c))},Complex.prototype.exp=function(){return new MathLib.Complex(MathLib.exp(this.re)*MathLib.cos(this.im),MathLib.exp(this.re)*MathLib.sin(this.im))},Complex.prototype.inverse=function(){return new MathLib.Complex(MathLib.divide(this.re,MathLib.plus(MathLib.pow(this.re,2),MathLib.pow(this.im,2))),MathLib.divide(MathLib.negative(this.im),MathLib.plus(MathLib.pow(this.re,2),MathLib.pow(this.im,2))))},Complex.prototype.isEqual=function(n){return"number"==typeof n?MathLib.isEqual(this.re,n)&&MathLib.isZero(this.im):"complex"===n.type?MathLib.isEqual(this.re,n.re)&&MathLib.isEqual(this.im,n.im):!1},Complex.prototype.isFinite=function(){return MathLib.isFinite(this.re)&&MathLib.isFinite(this.im)},Complex.prototype.isOne=function(){return MathLib.isOne(this.re)&&MathLib.isZero(this.im)},Complex.prototype.isReal=function(){return MathLib.isZero(this.im)},Complex.prototype.isZero=function(){return MathLib.isZero(this.re)&&MathLib.isZero(this.im)},Complex.prototype.ln=function(){return new MathLib.Complex(MathLib.ln(this.abs()),this.arg())},Complex.prototype.minus=function(c){return this.plus(MathLib.negative(c))},Complex.prototype.negative=function(){return new MathLib.Complex(MathLib.negative(this.re),MathLib.negative(this.im))},Complex.one=new Complex(1,0),Complex.prototype.plus=function(c){return"complex"===c.type?new MathLib.Complex(MathLib.plus(this.re,c.re),MathLib.plus(this.im,c.im)):("rational"===c.type&&(c=c.toNumber()),"number"==typeof c?new MathLib.Complex(MathLib.plus(this.re,c),this.im):void 0)},Complex.polar=function(abs,arg){return new MathLib.Complex(abs*Math.cos(arg),abs*Math.sin(arg))},Complex.prototype.pow=function(n){return new MathLib.Complex(Math.pow(this.abs(),n),n*this.arg())},Complex.prototype.sign=function(){return MathLib.Complex.polar(1,this.arg())},Complex.prototype.sin=function(){return new MathLib.Complex(MathLib.sin(this.re)*MathLib.cosh(this.im),MathLib.cos(this.re)*MathLib.sinh(this.im))},Complex.prototype.sinh=function(){return new MathLib.Complex(MathLib.cos(this.im)*MathLib.sinh(this.re),MathLib.sin(this.im)*MathLib.cosh(this.re))},Complex.prototype.sqrt=function(){return MathLib.Complex.polar(Math.sqrt(this.abs()),this.arg()/2)},Complex.prototype.times=function(c){return"complex"===c.type?new MathLib.Complex(MathLib.minus(MathLib.times(this.re,c.re),MathLib.times(this.im,c.im)),MathLib.plus(MathLib.times(this.re,c.im),MathLib.times(this.im,c.re))):("rational"===c.type&&(c=c.toNumber()),"number"==typeof c?new MathLib.Complex(MathLib.times(this.re,c),MathLib.times(this.im,c)):void 0)},Complex.prototype.toContentMathMLString=function(){return'<cn type="complex-cartesian">'+this.re+"<sep/>"+this.im+"</cn>"},Complex.prototype.toLaTeX=function(){var str="",reFlag=!1;return MathLib.isZero(this.re)||(str=MathLib.toLaTeX(this.re),reFlag=!0),MathLib.isZero(this.im)||(str+=MathLib.toLaTeX(this.im,reFlag)+"i"),0===str.length&&(str="0"),str},Complex.prototype.toMathMLString=function(){var str="",reFlag=!1;return MathLib.isZero(this.re)||(str=MathLib.toMathMLString(this.re),reFlag=!0),MathLib.isZero(this.im)||(str+=MathLib.toMathMLString(this.im,reFlag)+"<mo>&#x2062;</mo><mi>i</mi>"),0===str.length&&(str="<mn>0</mn>"),str},Complex.prototype.toMatrix=function(){return new MathLib.Matrix([[this.re,MathLib.negative(this.im)],[this.im,this.re]])},Complex.prototype.toPoint=function(){return new MathLib.Point(this.re,this.im)},Complex.prototype.toString=function(){var str="";return MathLib.isZero(this.re)||(str=MathLib.toString(this.re)),MathLib.isZero(this.im)||(str+=(this.im>0?str.length?"+":"":"-")+MathLib.toString(Math.abs(this.im))+"i"),0===str.length&&(str="0"),str},Complex.zero=new Complex(0,0),Complex}();MathLib.Complex=Complex;var Expression=function(){function Expression(expr){expr===void 0&&(expr={}),this.type="expression";var prop;"string"==typeof expr&&(expr=MathLib.Expression.parse(expr));for(prop in expr)this[prop]=expr[prop]}return Expression.prototype.numericallyEvaluate=function(){return"brackets"===this.subtype?this.content.numericallyEvaluate():"number"===this.subtype?parseFloat(this.value):"naryOperator"===this.subtype?MathLib[this.name].apply(null,this.content.map(function(x){return x.numericallyEvaluate()})):"unaryOperator"===this.subtype?"-"===this.value?MathLib.negative(this.content.numericallyEvaluate()):this.content.numericallyEvaluate():"functionCall"===this.subtype?MathLib[this.value].apply(null,this.content.map(function(x){return x.numericallyEvaluate()})):void 0},Expression.parse=function(str){var Token,Lexer,Parser;return Token={Operator:"Operator",Identifier:"Identifier",Number:"Number"},Lexer=function(){function peekNextChar(){var idx=index;return length>idx?expression.charAt(idx):"\0"}function getNextChar(){var ch="\0",idx=index;return length>idx&&(ch=expression.charAt(idx),index+=1),ch}function isWhiteSpace(ch){return"	"===ch||" "===ch||""===ch}function isLetter(ch){return ch>="a"&&"z">=ch||ch>="A"&&"Z">=ch}function isDecimalDigit(ch){return ch>="0"&&"9">=ch}function createToken(type,value){return{type:type,value:value,start:marker,end:index-1}}function skipSpaces(){for(var ch;length>index&&(ch=peekNextChar(),isWhiteSpace(ch));)getNextChar()}function scanOperator(){var ch=peekNextChar();return"+-*/()^%=;,".indexOf(ch)>=0?createToken(T.Operator,getNextChar()):void 0}function isIdentifierStart(ch){return"_"===ch||isLetter(ch)}function isIdentifierPart(ch){return isIdentifierStart(ch)||isDecimalDigit(ch)}function scanIdentifier(){var ch,id;if(ch=peekNextChar(),!isIdentifierStart(ch))return void 0;for(id=getNextChar();;){if(ch=peekNextChar(),!isIdentifierPart(ch))break;id+=getNextChar()}return createToken(T.Identifier,id)}function scanNumber(){var ch,number;if(ch=peekNextChar(),!isDecimalDigit(ch)&&"."!==ch)return void 0;if(number="","."!==ch)for(number=getNextChar();;){if(ch=peekNextChar(),!isDecimalDigit(ch))break;number+=getNextChar()}if("."===ch)for(number+=getNextChar();;){if(ch=peekNextChar(),!isDecimalDigit(ch))break;number+=getNextChar()}if("e"===ch||"E"===ch){if(number+=getNextChar(),ch=peekNextChar(),"+"!==ch&&"-"!==ch&&!isDecimalDigit(ch))throw ch="character "+ch,index>=length&&(ch="<end>"),new SyntaxError("Unexpected "+ch+" after the exponent sign");for(number+=getNextChar();;){if(ch=peekNextChar(),!isDecimalDigit(ch))break;number+=getNextChar()}}if("."===number)throw new SyntaxError("Expecting decimal digits after the dot sign");return createToken(T.Number,number)}function reset(str){expression=str,length=str.length,index=0}function next(){var token;if(skipSpaces(),index>=length)return void 0;if(marker=index,token=scanNumber(),token!==void 0)return token;if(token=scanOperator(),token!==void 0)return token;if(token=scanIdentifier(),token!==void 0)return token;throw new SyntaxError("Unknown token from character "+peekNextChar())}function peek(){var token,idx;idx=index;try{token=next(),delete token.start,delete token.end}catch(e){token=void 0}return index=idx,token}var expression="",length=0,index=0,marker=0,T=Token;return{reset:reset,next:next,peek:peek}},Parser=function(){function matchOp(token,op){return token!==void 0&&token.type===T.Operator&&token.value===op}function parseArgumentList(){for(var token,expr,args=[];;){if(expr=parseExpression(),expr===void 0)break;if(args.push(expr),token=lexer.peek(),!matchOp(token,","))break;lexer.next()}return args}function parseFunctionCall(name){var token,args=[];if(token=lexer.next(),!matchOp(token,"("))throw new SyntaxError('Expecting ( in a function call "'+name+'"');if(token=lexer.peek(),matchOp(token,")")||(args=parseArgumentList()),token=lexer.next(),!matchOp(token,")"))throw new SyntaxError('Expecting ) in a function call "'+name+'"');return new MathLib.Expression({subtype:"functionCall",value:name,content:args})}function parsePrimary(){var token,expr;if(token=lexer.peek(),token===void 0)throw new SyntaxError("Unexpected termination of expression");if(token.type===T.Identifier)return token=lexer.next(),matchOp(lexer.peek(),"(")?parseFunctionCall(token.value):new MathLib.Expression({subtype:"Identifier",value:token.value});if(token.type===T.Number)return token=lexer.next(),new MathLib.Expression({value:token.value,subtype:"number"});if(matchOp(token,"(")){if(lexer.next(),expr=parseAssignment(),token=lexer.next(),!matchOp(token,")"))throw new SyntaxError("Expecting )");return new MathLib.Expression({subtype:"brackets",value:"brackets",content:expr})}throw new SyntaxError("Parse error, can not process token "+token.value)}function parseUnary(){var token,expr;return token=lexer.peek(),matchOp(token,"-")||matchOp(token,"+")?(token=lexer.next(),expr=parseUnary(),new MathLib.Expression({subtype:"unaryOperator",value:token.value,content:expr})):parsePrimary()}function parseMultiplicative(){var token,left,right,r;if(left=parseUnary(),token=lexer.peek(),matchOp(token,"*")||matchOp(token,"/")){if(token=lexer.next(),right=parseMultiplicative(),"naryOperator"===right.subtype){for(r=right;"naryOperator"===r.content[0].subtype;)r=r.content[0];return r.content[0]=new MathLib.Expression({subtype:"naryOperator",content:[left,r.content[0]],value:token.value,name:"*"===token.value?"times":"divide"}),right}return new MathLib.Expression({subtype:"naryOperator",value:token.value,name:"*"===token.value?"times":"divide",content:[left,right]})}return left}function parseAdditive(){var token,left,right,r;if(left=parseMultiplicative(),token=lexer.peek(),matchOp(token,"+")||matchOp(token,"-")){if(token=lexer.next(),right=parseAdditive(),"+"===right.value||"-"===right.value){for(r=right;"naryOperator"===r.content[0].subtype;)r=r.content[0];return r.content[0]=new MathLib.Expression({subtype:"naryOperator",content:[left,r.content[0]],value:token.value,name:"+"===token.value?"plus":"minus"}),right}return new MathLib.Expression({subtype:"naryOperator",value:token.value,name:"+"===token.value?"plus":"minus",content:[left,right]})}return left}function parseAssignment(){var expr;return expr=parseAdditive()}function parseExpression(){return parseAssignment()}function parse(expression){var expr,token;if(lexer.reset(expression),expr=parseExpression(),token=lexer.next(),token!==void 0)throw new SyntaxError("Unexpected token "+token.value);return new MathLib.Expression(expr)}var lexer=new Lexer,T=Token;return{parse:parse}},Parser().parse(str)},Expression.prototype.toLaTeX=function(){var op;return"brackets"===this.subtype?"\\left("+this.content.toLaTeX()+"\\right)":"number"===this.subtype?this.value:"naryOperator"===this.subtype?(op="*"===this.value?"\\cdot":this.value,this.content.reduce(function(old,cur,idx){return old+(idx?op:"")+cur.toLaTeX()},"")):"unaryOperator"===this.subtype?"-"===this.value?"-"+this.content.toLaTeX():this.content.toLaTeX():"functionCall"===this.subtype?["arccos","arcsin","arctan","arg","cos","cosh","cot","coth","csc","deg","det","dim","gcd","lg","ln","log","max","min","sec","sin","sinh","tan","tanh"].indexOf(this.value)+1?"\\"+this.value+"\\left("+this.content.reduce(function(old,cur,idx){return old+(idx?",":"")+cur.toLaTeX()},"")+"\\right)":"exp"===this.value?"e^{"+this.content.reduce(function(old,cur,idx){return old+(idx?",":"")+cur.toLaTeX()},"")+"}":"sqrt"===this.value?"\\"+this.value+"{"+this.content.reduce(function(old,cur,idx){return old+(idx?",":"")+cur.toLaTeX()},"")+"}":"\\operatorname{"+this.value+"}\\left("+this.content.reduce(function(old,cur,idx){return old+(idx?",":"")+cur.toLaTeX()},"")+"\\right)":void 0},Expression.prototype.toString=function(){var _this=this;return"brackets"===this.subtype?"("+(""+this.content)+")":"number"===this.subtype?this.value:"naryOperator"===this.subtype?this.content.reduce(function(old,cur){return old+_this.value+cur}):"unaryOperator"===this.subtype?"-"===this.value?"-"+(""+this.content):""+this.content:"functionCall"===this.subtype?this.value+"("+this.content.reduce(function(old,cur){return old+","+cur})+")":void 0},Expression}();MathLib.Expression=Expression;var Line=function(_super){function Line(coords){_super.call(this,coords),this.type="line",this.dimension=2}return __extends(Line,_super),Line.prototype.draw=function(screen,options){if(Array.isArray(screen)){var line=this;screen.forEach(function(x){x.line(line,options)})}else screen.line(this,options);return this},Line.prototype.isEqual=function(q){var p=this.normalize();return q=q.normalize(),this.length!==q.length?!1:p.every(function(x,i){return MathLib.isEqual(x,q[i])})},Line.prototype.isFinite=function(){return!MathLib.isZero(this[this.length-1])},Line.prototype.isOrthogonalTo=function(l){return MathLib.isEqual(new MathLib.Point([0,0,1]).crossRatio(this.meet(new MathLib.Line([0,0,1])),l.meet(new MathLib.Line([0,0,1])),MathLib.Point.I,MathLib.Point.J),-1)},Line.prototype.isParallelTo=function(l){return this.every(function(x,i){return MathLib.isEqual(x,l[i])||i===l.length-1})},Line.prototype.meet=function(l,dyn){dyn===void 0&&(dyn=!1);var point,k=this;return 2===this.dimension&&2===l.dimension?(point=new MathLib.Point(this.vectorProduct(l)),dyn&&Object.defineProperties(point,{0:{get:function(){return k[1]*l[2]-k[2]*l[1]},set:function(){},enumerable:!0,configurable:!0},1:{get:function(){return k[2]*l[0]-k[0]*l[2]},set:function(){},enumerable:!0,configurable:!0},2:{get:function(){return k[0]*l[1]-k[1]*l[0]},set:function(){},enumerable:!0,configurable:!0}}),point):void 0},Line.prototype.normalize=function(){var h=MathLib.hypot(this[0],this[1]);return this.map(function(x){return x/h})},Line}(Vector);MathLib.Line=Line;var Matrix=function(){function Matrix(matrix){var _this=this;if(this.type="matrix","string"==typeof matrix){if(matrix.indexOf("<")>-1)return new MathLib.MathML(matrix).parse();matrix=matrix.trim().replace(/;?\n/g,"],["),matrix=JSON.parse("[["+matrix+"]]")}matrix.forEach(function(x,i){_this[i]=x}),this.length=matrix.length,this.cols=matrix[0].length,this.rows=matrix.length}return Matrix.prototype.LU=function(dontSwapPivot){var i,j,k,t,p,LU=this.toArray(),m=this.rows,n=this.cols,permutation=[];for(k=0;n>k;k++){if(!dontSwapPivot){for(p=k,i=k+1;m>i;i++)Math.abs(LU[i][k])>Math.abs(LU[p][k])&&(p=i);p!==k&&(permutation.unshift([p,k]),t=LU[p],LU[p]=LU[k],LU[k]=t)}if(0!==LU[k][k])for(i=k+1;m>i;i++)for(LU[i][k]=MathLib.divide(LU[i][k],LU[k][k]),j=k+1;n>j;j++)LU[i][j]=MathLib.minus(LU[i][j],MathLib.times(LU[i][k],LU[k][j]))}return LU=new MathLib.Matrix(LU),this.LU=function(){return LU},this.LUpermutation=new MathLib.Permutation(permutation),LU},Matrix.prototype.adjoint=function(){return this.map(MathLib.conjugate).transpose()},Matrix.prototype.adjugate=function(){return this.map(function(x,r,c,m){return MathLib.times(m.remove(c,r).determinant(),1-2*((r+c)%2))})},Matrix.prototype.cholesky=function(){var r,rr,k,kk,sum,c,cholesky,temp=[];for(r=0,rr=this.rows;rr>r;r++)temp.push([]);for(r=0,rr=this.rows;rr>r;r++){for(c=0;r>c;c++){for(sum=0,k=0,kk=c;kk>k;k++)sum=MathLib.plus(sum,MathLib.times(temp[r][k],temp[c][k]));temp[r][c]=(this[r][c]-sum)/temp[c][c]}for(sum=0,k=0,kk=c;kk>k;k++)sum=MathLib.plus(sum,MathLib.times(temp[r][k],temp[r][k]));for(temp[r][c]=Math.sqrt(this[c][c]-sum),c++;this.cols>c;c++)temp[r][c]=0}return cholesky=new MathLib.Matrix(temp),this.cholesky=function(){return cholesky},cholesky},Matrix.prototype.copy=function(){return this.map(MathLib.copy)},Matrix.prototype.determinant=function(){if(this.isSquare()){var arr,determinant;return this.rank()<this.rows?determinant=0:(arr=this.LU(),determinant=MathLib.times(this.LUpermutation.sgn(),MathLib.times.apply(null,arr.diag()))),this.determinant=function(){return determinant},determinant}},Matrix.prototype.diag=function(){var i,ii,arr=[];for(i=0,ii=Math.min(this.rows,this.cols);ii>i;i++)arr.push(this[i][i]);return arr},Matrix.prototype.divide=function(n){return this.times(MathLib.inverse(n))},Matrix.prototype.every=function(f){return Array.prototype.every.call(this,function(x,i){return Array.prototype.every.call(x,function(y,j){return f(y,i,j,this)})})},Matrix.prototype.forEach=function(f){Array.prototype.forEach.call(this,function(x,i){return Array.prototype.forEach.call(x,function(y,j){return f(y,i,j,this)})})},Matrix.prototype.gershgorin=function(){var i,ii,c=[],rc=[],rr=[],res=[];for(i=0,ii=this.rows;ii>i;i++)rc.push(0),rr.push(0);for(this.forEach(function(x,i,j){i===j?MathLib.is(x,"complex")?c.push(x.toPoint()):c.push(new MathLib.Point([x,0,1])):(rc[j]+=MathLib.abs(x),rr[i]+=MathLib.abs(x))}),i=0,ii=this.rows;ii>i;i++)res.push(new MathLib.Circle(c[i],Math.min(rc[i],rr[i])));return res},Matrix.prototype.givens=function(){var c,s,rho,i,j,k,ri,rj,qi,qj,rows=this.rows,cols=this.cols,R=this.copy(),Q=MathLib.Matrix.identity(rows);for(i=0;cols>i;i++)for(j=i+1;rows>j;j++)if(!MathLib.isZero(R[j][i])){for(rho=(0>R[i][i]?-1:1)*MathLib.hypot(R[i][i],R[j][i]),c=R[i][i]/rho,s=R[j][i]/rho,ri=[],rj=[],qi=[],qj=[],k=0;cols>k;k++)ri.push(R[i][k]),rj.push(R[j][k]);for(k=0;cols>k;k++)R[i][k]=rj[k]*s+ri[k]*c,R[j][k]=rj[k]*c-ri[k]*s;for(k=0;rows>k;k++)qi.push(Q[k][i]),qj.push(Q[k][j]);for(k=0;rows>k;k++)Q[k][i]=qi[k]*c+qj[k]*s,Q[k][j]=-qi[k]*s+qj[k]*c}return[Q,R]},Matrix.givensMatrix=function(n,i,k,phi){var givens=MathLib.Matrix.identity(n);return givens[k][k]=givens[i][i]=Math.cos(phi),givens[i][k]=Math.sin(phi),givens[k][i]=-givens[i][k],givens},Matrix.identity=function(n){var i,ii,temp=[],arr=[];for(n=n||1,i=0,ii=n-1;ii>i;i++)temp.push(0);for(temp.push(1),temp=temp.concat(temp),temp=temp.slice(0,-1),i=0,ii=n;ii>i;i++)arr.push(temp.slice(n-i-1,2*n-i-1));return new MathLib.Matrix(arr)},Matrix.prototype.inverse=function(){return this.isSquare()||!this.determinant()?this.adjugate().divide(this.determinant()):void 0},Matrix.prototype.isBandMatrix=function(l,u){return 1===arguments.length&&(u=l),this.every(function(x,i,j){return j>=i-l&&i+u>=j||MathLib.isZero(x)})},Matrix.prototype.isDiag=function(){var i,j,ii,jj;if((this.hasOwnProperty("isUpper")&&this.isUpper())+ +(this.hasOwnProperty("isLower")&&this.isLower())+ +(this.hasOwnProperty("isSymmetric")&&this.isSymmetric())>1)return!0;for(i=0,ii=this.rows;ii>i;i++)for(j=0,jj=this.cols;jj>j;j++)if(i!==j&&0!==this[i][j])return!1;return!0},Matrix.prototype.isEqual=function(x){var i,j,ii,jj;if(this===x)return!0;if(this.rows===x.rows&&this.cols===x.cols){for(i=0,ii=this.rows;ii>i;i++)for(j=0,jj=this.cols;jj>j;j++)if(!MathLib.isEqual(this[i][j],x[i][j]))return!1;return!0}return!1},Matrix.prototype.isIdentity=function(){if(!this.isSquare())return!1;var isIdentity=this.every(function(x,r,c){return r===c?MathLib.isOne(x):MathLib.isZero(x)});return this.isIdentity=function(){return isIdentity},isIdentity},Matrix.prototype.isInvertible=function(){return this.isSquare()&&this.rank()===this.rows},Matrix.prototype.isLower=function(){return this.slice(0,-1).every(function(x,i){return x.slice(i+1).every(MathLib.isZero)})},Matrix.prototype.isNegDefinite=function(){return this.isSquare()?1===this.rows?0>this[0][0]:0===this.rows%2?this.determinant()>0&&this.remove(this.rows-1,this.cols-1).isNegDefinite():0>this.determinant()&&this.remove(this.rows-1,this.cols-1).isNegDefinite():void 0},Matrix.prototype.isOrthogonal=function(){return this.transpose().times(this).isIdentity()},Matrix.prototype.isPermutation=function(){var rows=[],cols=[];return this.every(function(x,r,c){return MathLib.isOne(x)?rows[r]||cols[c]?!1:(rows[r]=!0,cols[c]=!0,!0):MathLib.isZero(x)?!0:!1})&&rows.length===this.rows&&cols.length===this.cols},Matrix.prototype.isPosDefinite=function(){return this.isSquare()?1===this.rows?this[0][0]>0:this.determinant()>0&&this.remove(this.rows-1,this.cols-1).isPosDefinite():void 0},Matrix.prototype.isReal=function(){return this.every(MathLib.isReal)},Matrix.prototype.isScalar=function(){var i,n=this.rows,diag=this.diag;if(this.hasOwnProperty("isIdentity")&&this.hasOwnProperty("isZero"))return this.isIdentity()||this.isZero()?!0:!1;if(this.isDiag()){for(i=1;n>i;i++)if(!MathLib.isEqual(diag[0],diag[i]))return!1;return!0}return!1},Matrix.prototype.isSquare=function(){return this.cols===this.rows},Matrix.prototype.isSymmetric=function(){var i,j,bool=!0;if(this.isSquare()){lp:for(i=0;this.rows>i;i++)for(j=i+1;this.cols>j;j++)if(!MathLib.isEqual(this[i][j],this[j][i])){bool=!1;break lp}}else bool=!1;return this.isSymmetric=function(){return bool},bool},Matrix.prototype.isUpper=function(){return this.slice(1).every(function(x,i){return x.slice(0,i+1).every(MathLib.isZero)})},Matrix.prototype.isVector=function(){return 1===this.rows||1===this.cols},Matrix.prototype.isZero=function(){var isZero=this.every(MathLib.isZero);return this.isZero=function(){return isZero},isZero},Matrix.prototype.map=function(f){var m=this;return new MathLib.Matrix(Array.prototype.map.call(this,function(x,i){return Array.prototype.map.call(x,function(y,j){return f(y,i,j,m)})}))},Matrix.prototype.minor=function(r,c){return this.remove(r,c).determinant()},Matrix.prototype.minus=function(m){return this.plus(m.negative())},Matrix.prototype.negative=function(){var i,ii,res=[];for(i=0,ii=this.rows;ii>i;i++)res.push(this[i].map(MathLib.negative));return new MathLib.Matrix(res)},Matrix.numbers=function(n,r,c){var i,ii,help=[],res=[];for(i=0,ii=c||r||1;ii>i;i++)help.push(n);for(i=0,ii=r||1;ii>i;i++)res.push(help.slice(0));return new MathLib.Matrix(res)},Matrix.one=function(r,c){return r=r||1,c=c||1,MathLib.Matrix.numbers(1,r,c)},Matrix.prototype.plus=function(m){var i,j,res=[],r=this.rows,c=this.cols;for(i=0;r>i;i++)for(res[i]=[],j=0;c>j;j++)res[i][j]=MathLib.plus(this[i][j],m[i][j]);return new MathLib.Matrix(res)},Matrix.random=function(r,c){var temp,i,j,ii,jj,arr=[];for(i=0,ii=r||1;ii>i;i++){for(temp=[],j=0,jj=c||r||1;jj>j;j++)temp.push(Math.random());arr.push(temp)}return new MathLib.Matrix(arr)},Matrix.prototype.rank=function(){var mat,i,j,rank=0;mat=this.rref();label:for(i=Math.min(this.rows,this.cols)-1;i>=0;i--)for(j=this.cols-1;j>=i;j--)if(!MathLib.isZero(mat[i][j])){rank=i+1;break label}return this.rank=function(){return rank},rank},Matrix.prototype.reduce=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return Array.prototype.reduce.apply(this,args)},Matrix.prototype.remove=function(row,col){var res=this.toArray();return(row||0===row)&&("number"==typeof row&&(row=[row]),res=res.filter(function(x,i){return-1===row.indexOf(i)})),(col||0===col)&&("number"==typeof col&&(col=[col]),col=col.sort().reverse(),col.forEach(function(n){res=res.map(function(x){return x.splice(n,1),x})})),new MathLib.Matrix(res)},Matrix.prototype.rref=function(){var i,j,r,val,lead=0,rref=this.toArray();for(r=0;this.rows>r;r++){if(lead>=this.cols)return new MathLib.Matrix(rref);for(i=r;0===rref[i][lead];)if(i++,this.rows===i&&(i=r,lead++,this.cols===lead))return new MathLib.Matrix(rref);var tmp=rref[i];for(rref[i]=rref[r],rref[r]=tmp,val=rref[r][lead],j=0;this.cols>j;j++)rref[r][j]/=val;for(i=0;this.rows>i;i++)if(i!==r)for(val=rref[i][lead],j=0;this.cols>j;j++)rref[i][j]=MathLib.minus(rref[i][j],MathLib.times(val,rref[r][j]));lead++}return new MathLib.Matrix(rref)},Matrix.prototype.slice=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return Array.prototype.slice.apply(this,args)},Matrix.prototype.solve=function(b){var i,j,LU=this.LU(),n=b.length,x=[],y=[];for(b=this.LUpermutation.applyTo(b),i=0;n>i;i++)for(y[i]=b[i],j=0;i>j;j++)y[i]=MathLib.minus(y[i],MathLib.times(LU[i][j],y[j]));
for(i=n-1;i>=0;i--){for(x[i]=y[i],j=i+1;n>j;j++)x[i]=MathLib.minus(x[i],MathLib.times(LU[i][j],x[j]));x[i]=MathLib.divide(x[i],LU[i][i])}return new b.constructor(x)},Matrix.prototype.some=function(f){return Array.prototype.some.call(this,function(x,i){return Array.prototype.some.call(x,function(y,j){return f(y,i,j,this)})})},Matrix.prototype.times=function(a){var temp,i,j,k,res=[];if("rational"===a.type&&(a=a.toNumber()),"number"==typeof a||"complex"===a.type)return this.map(function(x){return MathLib.times(x,a)});if("matrix"===a.type){if(this.cols===a.rows){for(i=0;this.rows>i;i++)for(res[i]=[],j=0;a.cols>j;j++){for(temp=0,k=0;this.cols>k;k++)temp=MathLib.plus(temp,MathLib.times(this[i][k],a[k][j]));res[i][j]=temp}return new MathLib.Matrix(res)}}else if(("point"===a.type||"vector"===a.type)&&this.cols===a.length){for(j=0;this.rows>j;j++){for(temp=0,k=0;this.cols>k;k++)temp=MathLib.plus(temp,MathLib.times(this[j][k],a[k]));res.push(temp)}return new a.constructor(res)}},Matrix.prototype.toArray=function(){return Array.prototype.map.call(this,function(x){return Array.prototype.map.call(x,function(y){return MathLib.copy(y)})})},Matrix.prototype.toColVectors=function(){return this.transpose().toRowVectors()},Matrix.prototype.toComplex=function(){return 2===this.rows&&2===this.cols&&this[0][0]===this[1][1]&&this[0][1]===MathLib.negative(this[1][0])?new MathLib.Complex(this[0][0],this[1][0]):void 0},Matrix.prototype.toContentMathMLString=function(){return this.reduce(function(str,x){return str+x.reduce(function(prev,cur){return prev+MathLib.toContentMathMLString(cur)},"<matrixrow>")+"</matrixrow>"},"<matrix>")+"</matrix>"},Matrix.prototype.toLaTeX=function(){return"\\begin{pmatrix}\n"+this.reduce(function(str,x){return str+x.reduce(function(prev,cur){return prev+" & "+MathLib.toLaTeX(cur)})+"\\\n"},"").slice(0,-2)+"\n\\end{pmatrix}"},Matrix.prototype.toMathMLString=function(){return this.reduce(function(str,x){return str+x.reduce(function(prev,cur){return prev+"<mtd>"+MathLib.toMathMLString(cur)+"</mtd>"},"<mtr>")+"</mtr>"},"<mrow><mo> ( </mo><mtable>")+"</mtable><mo> ) </mo></mrow>"},Matrix.prototype.toRowVectors=function(){return this.toArray().map(function(v){return new MathLib.Vector(v)})},Matrix.prototype.toString=function(){return this.reduce(function(str,x){return str+x.reduce(function(prev,cur){return prev+"	"+MathLib.toString(cur)})+"\n"},"").slice(0,-1)},Matrix.prototype.trace=function(){var trace=MathLib.plus.apply(null,this.diag());return this.trace=function(){return trace},trace},Matrix.prototype.transpose=function(){var transpose,help,i,j,ii,jj,temp=[];for(i=0,ii=this.cols;ii>i;i++){for(help=[],j=0,jj=this.rows;jj>j;j++)help.push(this[j][i]);temp.push(help)}return transpose=new MathLib.Matrix(temp),this.transpose=function(){return transpose},transpose},Matrix.zero=function(r,c){return r=r||1,c=c||1,MathLib.Matrix.numbers(0,r,c)},Matrix}();MathLib.Matrix=Matrix;var Permutation=function(){function Permutation(p){var _this=this;this.type="permutation";var cycle,permutation;Array.isArray(p[0])?(cycle=p,permutation=Permutation.cycleToList(cycle)):(permutation=p,cycle=Permutation.listToCycle(permutation)),permutation.forEach(function(x,i){_this[i]=x}),this.length=permutation.length,this.cycle=cycle}return Permutation.prototype.applyTo=function(n){var p,res;return"number"==typeof n?n>=this.length?n:this[n]:(p=this,res=n.map(function(x,i){return n[p.applyTo(i)]}),void 0===n.type?res:new n.constructor(res))},Permutation.cycleToList=function(cycle){var index,cur,i,ii,j,jj,max,res=[];for(max=cycle.map(function(b){return Math.max.apply(null,b)}),max=Math.max.apply(null,max),i=0,ii=max;ii>=i;i++){for(cur=i,j=0,jj=cycle.length;jj>j;j++)index=cycle[j].indexOf(cur),++index&&(cur=cycle[j][index%cycle[j].length]);res.push(cur)}return res},Permutation.id=new Permutation([[]]),Permutation.prototype.inverse=function(){var cycle=this.cycle.slice(0);return cycle.reverse().forEach(function(e){e.reverse()}),new MathLib.Permutation(cycle)},Permutation.listToCycle=function(list){var cur,i,ii,temp,finished=[],res=[];for(i=0,ii=list.length;ii>i;i++){for(cur=i,temp=[];!finished[cur];)finished[cur]=!0,temp.push(cur),cur=list[cur];temp.length&&res.push(temp)}return res},Permutation.prototype.map=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return new MathLib.Permutation(Array.prototype.map.apply(this,args))},Permutation.prototype.sgn=function(){var i,count=0;for(i=0;this.cycle.length>i;i++)count+=this.cycle[i].length;return count+=this.cycle.length,-2*(count%2)+1},Permutation.prototype.times=function(p){var a=this;return p.map(function(x){return a[x]})},Permutation.prototype.toMatrix=function(n){var temp,i,ii,arr=[],res=[];for(n=n||this.length,i=0,ii=n-1;ii>i;i++)arr.push(0);for(arr=arr.concat([1]).concat(arr),i=0,ii=n;ii>i;i++)temp=n-this.applyTo(i)-1,res.push(arr.slice(temp,temp+n));return new MathLib.Matrix(res)},Permutation.prototype.toString=function(){var str="";return this.cycle.forEach(function(elem){str+="("+(""+elem)+")"}),str},Permutation}();MathLib.Permutation=Permutation;var Point=function(_super){function Point(coords){_super.call(this,arguments.length>1?Array.prototype.slice.call(arguments).concat(1):coords),this.dimension=2,this.type="point"}return __extends(Point,_super),Point.I=new Point([new MathLib.Complex(0,-1),0,1]),Point.J=new Point([new MathLib.Complex(0,1),0,1]),Point.prototype.crossRatio=function(a,b,c,d){var xa=this.vectorProduct(a),xb=this.vectorProduct(b);return xa.scalarProduct(c)*xb.scalarProduct(d)/(xa.scalarProduct(d)*xb.scalarProduct(c))},Point.prototype.distanceTo=function(point){return 0===arguments.length?MathLib.hypot.apply(null,this.slice(0,-1))/Math.abs(this[this.dimension]):"point"===point.type&&this.dimension===point.dimension?MathLib.hypot.apply(null,this.normalize().minus(point.normalize()).slice(0,-1)):void 0},Point.prototype.draw=function(screen,options){if(Array.isArray(screen)){var point=this;screen.forEach(function(x){x.point(point,options)})}else screen.point(this,options);return this},Point.prototype.isEqual=function(q){var p=this.normalize();return q=q.normalize(),this.length!==q.length?!1:p.every(function(x,i){return MathLib.isEqual(x,q[i])})},Point.prototype.isFinite=function(){return!MathLib.isZero(this[this.length-1])},Point.prototype.isInside=function(a){return"circle"===a.type?this.distanceTo(a.center)<a.radius:void 0},Point.prototype.isOn=function(a){return"line"===a.type?this.distanceTo(a.center)===a.radius:"circle"===a.type?this.distanceTo(a.center)===a.radius:void 0},Point.prototype.isOutside=function(a){return"circle"===a.type?this.distanceTo(a.center)>a.radius:void 0},Point.prototype.lineTo=function(q,dyn){dyn===void 0&&(dyn=!1);var line,p=this;return 2===this.dimension&&2===q.dimension?(line=new MathLib.Line(this.vectorProduct(q)),dyn&&Object.defineProperties(line,{0:{get:function(){return p[1]*q[2]-p[2]*q[1]},set:function(){},enumerable:!0,configurable:!0},1:{get:function(){return p[2]*q[0]-p[0]*q[2]},set:function(){},enumerable:!0,configurable:!0},2:{get:function(){return p[0]*q[1]-p[1]*q[0]},set:function(){},enumerable:!0,configurable:!0}}),line):void 0},Point.prototype.normalize=function(){var last=this[this.dimension]||1;return this.map(function(x){return x/last})},Point.prototype.reflectAt=function(a){if("point"===a.type&&this.dimension===a.dimension){var i,arr=[],p=this.normalize();for(a=a.normalize(),i=0;this.dimension>i;i++)arr.push(2*a[i]-p[i]);return arr.push(1),new MathLib.Point(arr)}},Point.prototype.toComplex=function(){return 2===this.dimension?MathLib.isZero(this[2])?MathLib.Complex.infinity:new MathLib.Complex(this[0]/this[2],this[1]/this[2]):void 0},Point.prototype.toLaTeX=function(opt){opt===void 0&&(opt=!1);var p=opt?this.toArray():this.normalize().slice(0,-1);return"\\begin{pmatrix}"+p.reduce(function(old,cur){return old+"\\\\"+MathLib.toLaTeX(cur)})+"\\end{pmatrix}"},Point.prototype.toMathMLString=function(opt){opt===void 0&&(opt=!1);var p=opt?this.toArray():this.normalize().slice(0,-1);return p.reduce(function(old,cur){return old+"<mtr><mtd>"+MathLib.toMathMLString(cur)+"</mtd></mtr>"},"<mrow><mo>(</mo><mtable>")+"</mtable><mo>)</mo></mrow>"},Point.prototype.toString=function(opt){opt===void 0&&(opt=!1);var p=opt?this.toArray():this.normalize().slice(0,-1);return"("+p.reduce(function(old,cur){return old+", "+MathLib.toString(cur)})+")"},Point}(Vector);MathLib.Point=Point;var Polynomial=function(){function Polynomial(polynomial){var _this=this;this.type="polynomial";var temp=[];if(void 0===polynomial||0===polynomial.length)polynomial=[0];else if("number"==typeof polynomial){for(;polynomial--;)temp.push(0);temp.push(1),polynomial=temp}polynomial.forEach(function(x,i){_this[i]=x}),this.length=polynomial.length,this.deg=polynomial.length-1,this.subdeg=function(a){var i=0;if(a.length>1||a[0]){for(;a.length>i&&MathLib.isZero(a[i]);)i++;return i}return 1/0}(polynomial)}return Polynomial.prototype.differentiate=function(n){n===void 0&&(n=1);var i,temparr=[];if(0===n)return this;for(i=0;this.deg-n>=i;i++)temparr[i]=MathLib.times(this[i+n],MathLib.fallingFactorial(i+n,n));return new MathLib.Polynomial(temparr)},Polynomial.prototype.draw=function(screen,options){var i,path=[],line=this;if(2>this.deg)Array.isArray(screen)?screen.forEach(function(x){x.line([[-50,line.valueAt(-50)],[50,line.valueAt(50)]],options)}):screen.line([[-50,this.valueAt(-50)],[50,this.valueAt(50)]],options);else{for(i=-50;50>=i;i=Math.round(100*(i+.01))/100)path.push([i,this.valueAt(i)]);Array.isArray(screen)?screen.forEach(function(x){x.path(path,options)}):screen.path(path,options)}return this},Polynomial.prototype.every=function(f){return Array.prototype.every.call(this,f)},Polynomial.prototype.forEach=function(){Array.prototype.forEach.apply(this,arguments)},Polynomial.prototype.integrate=function(n){n===void 0&&(n=1);var i,temparr=[];if(MathLib.isZero(n))return this;for(i=0;n>i;i++)temparr.push(0);for(i=0;this.deg>=i;i++)temparr[i+n]=this[i]/MathLib.fallingFactorial(i+n,n);return new MathLib.Polynomial(temparr)},Polynomial.prototype.interpolation=function(a,b){var temp,i,j,res=new MathLib.Polynomial([0]),n=a.length;for(2===arguments.length&&(a=a.map(function(x,i){return[x,b[i]]})),i=0;n>i;i++){for(temp=new MathLib.Polynomial([1]),j=0;n>j;j++)i!==j&&(temp=temp.times(new MathLib.Polynomial([-a[j][0]/(a[i][0]-a[j][0]),1/(a[i][0]-a[j][0])])));res=res.plus(temp.times(a[i][1]))}return res},Polynomial.prototype.isEqual=function(p){var i,ii;if(this.deg!==p.deg||this.subdeg!==p.subdeg)return!1;for(i=0,ii=this.deg;ii>=i;i++)if(!MathLib.isEqual(this[i],p[i]))return!1;return!0},Polynomial.prototype.map=function(f){return new MathLib.Polynomial(Array.prototype.map.call(this,f))},Polynomial.prototype.negative=function(){return new MathLib.Polynomial(this.map(MathLib.negative))},Polynomial.one=new Polynomial([1]),Polynomial.prototype.plus=function(a){var i,temparr=[];if("number"==typeof a)temparr=this.slice(),temparr[0]=MathLib.plus(temparr[0],a);else if("polynomial"===a.type){for(i=0;Math.min(this.deg,a.deg)>=i;i++)temparr[i]=MathLib.plus(this[i],a[i]);temparr=temparr.concat((this.deg>a.deg?this:a).slice(i))}return new MathLib.Polynomial(temparr)},Polynomial.regression=function(x,y){var m,c,i,length=x.length,xy=0,xi=0,yi=0,x2=0;if(2===arguments.length)for(i=0;length>i;i++)xy+=x[i]*y[i],xi+=x[i],yi+=y[i],x2+=x[i]*x[i];else for(i=0;length>i;i++)xy+=x[i][0]*x[i][1],xi+=x[i][0],yi+=x[i][1],x2+=x[i][0]*x[i][0];return m=(length*xy-xi*yi)/(length*x2-xi*xi),c=(yi*x2-xy*xi)/(length*x2-xi*xi),new MathLib.Polynomial([c,m])},Polynomial.roots=function(zeros){var temp,i,ii,coef=[];for("array"===MathLib.type(zeros)&&(zeros=MathLib.set(zeros,!0)),temp=zeros.powerset(),i=0,ii=zeros.card;ii>i;i++)coef[i]=0;return temp.slice(1).forEach(function(x){coef[ii-x.card]=MathLib.plus(coef[ii-x.card],x.times())}),coef=coef.map(function(x,i){return(ii-i)%2?MathLib.negative(x):x}),coef.push(1),new MathLib.Polynomial(coef)},Polynomial.prototype.slice=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return Array.prototype.slice.apply(this,args)},Polynomial.prototype.times=function(a){var i,j,temparr=[];if("rational"===a.type&&(a=a.toNumber()),"polynomial"===a.type){for(i=0;this.deg>=i;i++)for(j=0;a.deg>=j;j++)temparr[i+j]=MathLib.plus(temparr[i+j]?temparr[i+j]:0,MathLib.times(this[i],a[j]));return new MathLib.Polynomial(temparr)}return this.map(function(b){return MathLib.times(a,b)})},Polynomial.prototype.toContentMathMLString=function(math){var i,str="<apply><plus/>";for(i=this.deg;i>=0;i--)MathLib.isZero(this[i])||(str+=0===i?MathLib.toContentMathMLString(this[i]):"<apply><times/>"+MathLib.toContentMathMLString(this[i],!0),i>1?str+="<apply><power/><ci>x</ci>"+MathLib.toContentMathMLString(i)+"</apply></apply>":1===i&&(str+="<ci>x</ci></apply>"));return str+="</apply>",math&&(str='<math xmlns="http://www.w3.org/1998/Math/MathML"><lambda><bvar><ci>x</ci></bvar><domainofapplication><complexes/></domainofapplication>'+str+"</lambda></math>"),str},Polynomial.prototype.toFunctn=function(){var i,ii,str="";for(i=0,ii=this.deg;ii>=i;i++)MathLib.isZero(this[i])||(str+=0===i?MathLib.toString(this[i]):MathLib.toString(this[i],!0),i>1?str+="* Math.pow(x,"+MathLib.toString(i)+")":1===i&&(str+="*x"));return new MathLib.Functn(Function("x","return "+str),{contentMathMLString:this.toContentMathMLString(!0)})},Polynomial.prototype.toLaTeX=function(){var i,str=MathLib.toString(this[this.deg])+"x^{"+this.deg+"}";for(i=this.deg-1;i>=0;i--)MathLib.isZero(this[i])||(str+=MathLib.toLaTeX(this[i],!0),i>1?str+="x^{"+MathLib.toLaTeX(i)+"}":1===i&&(str+="x"));return str},Polynomial.prototype.toMathMLString=function(math){var i,str="<mrow>"+MathLib.toMathMLString(this[this.deg])+"<mo>&#x2062;</mo><msup><mi>x</mi>"+MathLib.toMathMLString(this.deg)+"</msup>";for(i=this.deg-1;i>=0;i--)MathLib.isZero(this[i])||(str+=MathLib.toMathMLString(this[i],!0),i>1?str+="<mo>&#x2062;</mo><msup><mi>x</mi>"+MathLib.toMathMLString(i)+"</msup>":1===i&&(str+="<mo>&#x2062;</mo><mi>x</mi>"));return str+="</mrow>",math&&(str='<math xmlns="http://www.w3.org/1998/Math/MathML">'+str+"</math>"),str},Polynomial.prototype.toString=function(){var i,str=MathLib.toString(this[this.deg])+"*x^"+this.deg;for(i=this.deg-1;i>=0;i--)MathLib.isZero(this[i])||(str+=MathLib.toString(this[i],!0),i>1?str+="*x^"+MathLib.toString(i):1===i&&(str+="*x"));return str},Polynomial.prototype.valueAt=function(x){var i,ii,pot=MathLib.is(x,"matrix")?MathLib.Matrix.identity(x.rows,x.cols):1,res=MathLib.is(x,"matrix")?MathLib.Matrix.zero(x.rows,x.cols):0;for(i=0,ii=this.deg;ii>=i;i++)res=MathLib.plus(res,MathLib.times(this[i],pot)),pot=MathLib.times(pot,x);return res},Polynomial.zero=new Polynomial([0]),Polynomial}();MathLib.Polynomial=Polynomial;var Rational=function(){function Rational(numerator,denominator){if(denominator===void 0&&(denominator=1),this.type="rational",MathLib.isZero(denominator))throw"The denominator cannot be zero.";this.numerator=numerator,this.denominator=denominator}return Rational.prototype.divide=function(r){return"rational"===r.type?new MathLib.Rational(MathLib.times(this.numerator,r.denominator),MathLib.times(this.denominator,r.numerator)):"number"==typeof r?new MathLib.Rational(this.numerator,MathLib.times(this.denominator,r)):r.inverse().times(this)},Rational.prototype.inverse=function(){return MathLib.isZero(this.numerator)?void 0:new MathLib.Rational(this.denominator,this.numerator)},Rational.prototype.isEqual=function(r){return MathLib.isEqual(MathLib.times(this.numerator,r.denominator),MathLib.times(this.denominator,r.numerator))},Rational.prototype.isZero=function(){return MathLib.isZero(this.numerator)},Rational.prototype.minus=function(r){var n=this.numerator,d=this.denominator;return"rational"===r.type?new MathLib.Rational(MathLib.minus(MathLib.times(n,r.denominator),MathLib.times(d,r.numerator)),MathLib.times(d,r.denominator)):"number"==typeof r?new MathLib.Rational(MathLib.minus(n,MathLib.times(r,d)),d):r.minus(this).negative()},Rational.prototype.negative=function(){return new MathLib.Rational(-this.numerator,this.denominator)},Rational.prototype.plus=function(r){var n=this.numerator,d=this.denominator;return"rational"===r.type?new MathLib.Rational(MathLib.plus(MathLib.times(d,r.numerator),MathLib.times(n,r.denominator)),MathLib.times(d,r.denominator)):"number"==typeof r?new MathLib.Rational(MathLib.plus(n,MathLib.times(r,d)),d):r.plus(this)},Rational.prototype.reduce=function(){var gcd=MathLib.sign(this.denominator)*MathLib.gcd([this.numerator,this.denominator]);return new MathLib.Rational(this.numerator/gcd,this.denominator/gcd)},Rational.prototype.times=function(r){return"rational"===r.type?new MathLib.Rational(MathLib.times(this.numerator,r.numerator),MathLib.times(this.denominator,r.denominator)):"number"==typeof r?new MathLib.Rational(MathLib.times(this.numerator,r),this.denominator):r.times(this)},Rational.prototype.toContentMathMLString=function(){return'<cn type="rational">'+this.numerator+"<sep/>"+this.denominator+"</cn>"},Rational.prototype.toLaTeX=function(){return"\\frac{"+MathLib.toLaTeX(this.numerator)+"}{"+MathLib.toLaTeX(this.denominator)+"}"},Rational.prototype.toMathMLString=function(){return"<mfrac>"+MathLib.toMathMLString(this.numerator)+MathLib.toMathMLString(this.denominator)+"</mfrac>"},Rational.prototype.toNumber=function(){return this.numerator/this.denominator},Rational.prototype.toString=function(){return MathLib.toString(this.numerator)+"/"+MathLib.toString(this.denominator)},Rational}();MathLib.Rational=Rational;var Set=function(){function Set(elements){var _this=this;this.type="set",this.union=Set.createSetOperation(!0,!0,!0),this.intersect=Set.createSetOperation(!1,!0,!1),this.without=Set.createSetOperation(!0,!1,!1),this.xor=Set.createSetOperation(!0,!1,!0),elements||(elements=[]),elements=elements.sort(MathLib.compare),elements=elements.filter(function(x,i,a){return x!==a[i+1]}),elements.forEach(function(x,i){_this[i]=x}),this.length=elements.length,this.card=elements.length}return Set.prototype.compare=function(x){if(this.card!==x.card)return MathLib.sign(this.card-x.card);var res=0,stop=!1;return this.forEach(function(y,i){if(!stop){var a=MathLib.compare(y,x[i]);0!==a&&(res=a,stop=!0)}}),res},Set.prototype.every=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return Array.prototype.every.apply(this,args)},Set.prototype.filter=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return new MathLib.Set(Array.prototype.filter.apply(this,args))},Set.prototype.forEach=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];Array.prototype.forEach.apply(this,args)},Set.fromTo=function(f,t,s){s===void 0&&(s=1);var i,arr=[];if(t>=f){for(i=f;t>=i;i+=s)arr.push(i);return new MathLib.Set(arr)}},Set.prototype.indexOf=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return Array.prototype.indexOf.apply(this,args)},Set.prototype.insert=function(x){var i=this.locate(x);return this[i]!==x&&(this.splice(i,0,x),this.card++),this},Set.prototype.isEmpty=function(){return 0===this.card},Set.prototype.isEqual=function(x){return this.card!==x.card?!1:this.every(function(y,i){return MathLib.isEqual(y,x[i])})},Set.prototype.isSubsetOf=function(a){return this.every(function(x){return-1!==a.indexOf(x)})},Set.prototype.locate=function(x){var middle,left=0,right=this.card-1,i=this.indexOf(x);if(-1!==i)return i;for(;right>=left;)if(middle=left+Math.floor((right-left)/2),x>this[middle])left=middle+1;else{if(!(this[middle]>x))return middle;right=middle-1}return left},Set.prototype.map=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return new MathLib.Set(Array.prototype.map.apply(this,args))},Set.prototype.plus=function(n){var res=[];return arguments.length?"set"===n.type?(this.forEach(function(x){n.forEach(function(y){res.push(MathLib.plus(x,y))})}),new MathLib.Set(res)):this.map(function(x){return MathLib.plus(x,n)}):MathLib.plus.apply(null,this.toArray())},Set.prototype.powerset=function(){var arr,temp,i,ii,j,jj,res=[];for(i=0,ii=Math.pow(2,this.card);ii>i;i++){for(arr=i.toString(2).split("").reverse(),temp=[],j=0,jj=this.card;jj>j;j++)"1"===arr[j]&&temp.push(this[j]);res.push(new MathLib.Set(temp))}return new MathLib.Set(res)},Set.prototype.reduce=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return Array.prototype.reduce.apply(this,arguments)},Set.prototype.remove=function(a){var i=this.indexOf(a);return-1!==i&&(this.splice(i,1),this.card--),this},Set.createSetOperation=function(left,both,right){return function(a){for(var res=[],i=0,j=0,tl=this.card,al=a.card;tl>i&&al>j;)this[i]<a[j]?(left&&res.push(this[i]),i++):this[i]>a[j]?(right&&res.push(a[j]),j++):this[i]!==a[j]||(both&&res.push(this[i]),i++,j++);return left&&j===al?res=res.concat(this.slice(i)):right&&i===tl&&(res=res.concat(a.slice(j))),new MathLib.Set(res)}},Set.prototype.slice=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return Array.prototype.slice.apply(this,args)},Set.prototype.splice=function(){for(var args=[],_i=0;arguments.length-0>_i;_i++)args[_i]=arguments[_i+0];return Array.prototype.splice.apply(this,args)},Set.prototype.times=function(n){return arguments.length?this.map(function(x){return MathLib.times(x,n)}):MathLib.times.apply(null,this.toArray())},Set.prototype.toArray=function(){return Array.prototype.slice.call(this)},Set.prototype.toContentMathMLString=function(){return this.isEmpty()?"<emptyset/>":this.reduce(function(old,cur){return old+MathLib.toContentMathMLString(cur)},"<set>")+"</set>"},Set.prototype.toLaTeX=function(){return this.isEmpty()?"\\emptyset":this.reduce(function(old,cur){return old+MathLib.toLaTeX(cur)+", "},"\\{").slice(0,-2)+"\\}"},Set.prototype.toMathMLString=function(){return this.isEmpty()?"<mi>&#x2205;</mi>":this.reduce(function(old,cur){return old+MathLib.toMathMLString(cur)+"<mo>,</mo>"},"<mrow><mo>{</mo>").slice(0,-10)+"<mo>}</mo></mrow>"},Set.prototype.toString=function(){return this.isEmpty()?"":"("+Array.prototype.join.call(this,", ")+")"},Set}();MathLib.Set=Set}(MathLib||(MathLib={})),function(global){"use strict";function fullscreenchange(){var newEvent=document.createEvent("CustomEvent");newEvent.initCustomEvent("fullscreenchange",!0,!1,null),document.dispatchEvent(newEvent)}function fullscreenerror(){var newEvent=document.createEvent("CustomEvent");newEvent.initCustomEvent("fullscreenerror",!0,!1,null),document.dispatchEvent(newEvent)}var getter,elementPrototype=(global.HTMLElement||global.Element).prototype;document.hasOwnProperty("fullscreenEnabled")||(getter=function(){return"webkitIsFullScreen"in document?function(){return document.webkitFullscreenEnabled}:"mozFullScreenEnabled"in document?function(){return document.mozFullScreenEnabled}:function(){return!1}}()),document.hasOwnProperty("fullscreenElement")||(getter=function(){for(var i=0,name=["webkitCurrentFullScreenElement","webkitFullscreenElement","mozFullScreenElement"];name.length>i;i++)if(name[i]in document)return function(){return document[name[i]]};return function(){return null}}(),Object.defineProperty(document,"fullscreenElement",{enumerable:!0,configurable:!1,writeable:!1,get:getter})),document.addEventListener("webkitfullscreenchange",fullscreenchange,!1),document.addEventListener("mozfullscreenchange",fullscreenchange,!1),document.addEventListener("webkitfullscreenerror",fullscreenerror,!1),document.addEventListener("mozfullscreenerror",fullscreenerror,!1),elementPrototype.requestFullScreen||(elementPrototype.requestFullScreen=function(){return elementPrototype.webkitRequestFullScreen?function(){this.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:elementPrototype.mozRequestFullScreen?function(){this.mozRequestFullScreen()}:function(){}}()),document.exitFullScreen||(document.exitFullScreen=function(){return document.webkitCancelFullScreen||document.mozCancelFullScreen||function(){}}())}(window),!("setLineDash"in CanvasRenderingContext2D.prototype)){var setLineDash,getLineDash,setLineDashOffset,getLineDashOffset,prototype;"mozDash"in CanvasRenderingContext2D.prototype?(prototype=CanvasRenderingContext2D.prototype,setLineDash=function(dash){this.mozDash=dash},getLineDash=function(){return this.mozDash},setLineDashOffset=function(dashOffset){this.mozDashOffset=dashOffset},getLineDashOffset=function(){return this.mozDashOffset}):(prototype=CanvasRenderingContext2D.prototype,setLineDash=function(){},getLineDash=function(){},setLineDashOffset=function(){},getLineDashOffset=function(){}),Object.defineProperty(prototype,"setLineDash",{value:setLineDash,enumerable:!0,configurable:!1,writeable:!1}),Object.defineProperty(prototype,"getLineDash",{value:getLineDash,enumerable:!0,configurable:!1,writeable:!1}),Object.defineProperty(prototype,"lineDashOffset",{set:setLineDashOffset,get:getLineDashOffset,enumerable:!0,configurable:!1,writeable:!1})}